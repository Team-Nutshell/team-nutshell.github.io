# WebGPU Shader Editor (WGSL)

<script src="shader_editor.js" defer></script>
<p id="webgpuCheck"></p>
<p id="webgpuFPS"></p>
<center>
	<canvas id="webgpuCanvas" width="980" height="550"></canvas>
</center>
<div>
	<textarea class="highlight" id="webgpuFragmentShader" spellcheck="false" style="width: 95%; height: 275px; min-height: 100px; max-height: 750px; overflow-y: scroll; white-space: break-spaces; padding: 10px; border-style: solid; border-width: 1px; margin-bottom: 0px; resize: vertical;"></textarea>
	<button id="webgpuRefreshFragmentShader" style="width: 5%; height: 275px; min-height: 100px; max-height: 750px; float: right;">Run</button>
</div>
<p class="highlight" id="webgpuFragmentShaderCompilationMessage" style="width: 100%; height: 115px; min-height: 100px; max-height: 350px; overflow-y: scroll; white-space: break-spaces; padding: 10px; border-style: solid; border-width: 1px; border-color: rgb(100, 15, 0); resize: vertical;"></p>
<button id="webgpuResetCamera">Reset camera</button>

Click on the canvas to control the camera.

Use **WASD** to move the camera.

Use **arrow keys** to rotate the camera.

Use **space** to go up and **left shift** to go down.

Pre-defined variables:
```
time: f32 - Current timestamp in seconds, starting from 0.0 at application launch.
cameraPosition: vec3f - Current position of the camera, starting at vec3f(0.0, 0.0, 0.0).
cameraDirection: vec3f - Current direction of the camera, starting at vec3f(0.0, 0.0, 1.0).
resolution: vec2u - Resolution, is 980u by 600u pixels.
mouse: vec2i - Mouse position in pixels, top-left corner is (0, 0).
```

## Examples
### Bases
- [Empty shader](https://www.team-nutshell.dev/shader/editor.html)
- [Mouse position](https://www.team-nutshell.dev/shader/editor.html#QGZyYWdtZW50CmZuIG1haW4oQGxvY2F0aW9uKDApIHV2OiB2ZWMyZikgLT4gQGxvY2F0aW9uKDApIHZlYzRmIHsKCWxldCBtb3VzZVJlbGF0aXZlOiB2ZWMyZiA9IHZlYzJmKGYzMihtb3VzZS54KSAvIGYzMihyZXNvbHV0aW9uLngpLCBmMzIobW91c2UueSkgLyBmMzIocmVzb2x1dGlvbi55KSk7CgoJcmV0dXJuIHZlYzRmKGRpc3RhbmNlKG1vdXNlUmVsYXRpdmUsIHZlYzJmKHV2LngsIDEuMCAtIHV2LnkpKSwgMC4wLCAwLjAsIDEuMCk7Cn0K)
- [Ray marching base](https://www.team-nutshell.dev/shader/editor.html#Y29uc3QgTV9QSTogZjMyID0gMy4xNDE1OTI2NTM1ODk3OTMyMzg0NjI2NDMzODMyNzk1OwoKY29uc3QgTUFYX1NURVBTOiB1MzIgPSAyNTZ1Owpjb25zdCBNQVhfRElTVEFOQ0U6IGYzMiA9IDEwMDAuMDsKY29uc3QgRVBTSUxPTjogZjMyID0gMC4wMDAxOwpjb25zdCBNQVhfQk9VTkNFUzogdTMyID0gMXU7CgpzdHJ1Y3QgTWF0ZXJpYWwgewoJZGlmZnVzZTogdmVjM2YsCgltZXRhbGxpY1JvdWdobmVzczogdmVjMmYKfQoKc3RydWN0IE9iamVjdCB7CglkaXN0OiBmMzIsCgltYXQ6IE1hdGVyaWFsCn0KCnN0cnVjdCBMaWdodCB7CglsaWdodFR5cGU6IHUzMiwgLy8gMCA9IERpcmVjdGlvbmFsLCAxID0gUG9pbnQsIDIgPSBTcG90Cglwb3NpdGlvbjogdmVjM2YsCglkaXJlY3Rpb246IHZlYzNmLAoJY29sb3I6IHZlYzNmLAoJY3V0b2ZmczogdmVjMmYKfQoKLy8gR0xTTC10eXBlIG1vZCgpCmZuIGdsc2xtb2QoYTogZjMyLCBiOiBmMzIpIC0+IGYzMiB7Cgl2YXIgbTogZjMyID0gYSAlIGI7CglpZiAobSA8IDAuMCkgewoJCWlmIChiIDwgMC4wKSB7CgkJCW0gLT0gYjsKCQl9IGVsc2UgewoJCQltICs9IGI7CgkJfQoJfQoKCXJldHVybiBtOwp9CgovLyBSYW5kb20KZm4gcmFuZDFEKHNlZWQ6IGYzMikgLT4gZjMyIHsKCXJldHVybiBmcmFjdChzaW4oc2VlZCkpOwp9CgpmbiByYW5kMkQoc2VlZDogdmVjMmYpIC0+IGYzMiB7CglyZXR1cm4gZnJhY3Qoc2luKGRvdChzZWVkLCB2ZWMyZigxMi45ODk4LCA3OC4yMzMpKSkgKiA0Mzc1OC41NDUzMTIzKTsKfQoKZm4gbm9pc2UxRChzZWVkOiBmMzIpIC0+IGYzMiB7CglsZXQgaTogZjMyID0gZmxvb3Ioc2VlZCk7CglsZXQgZjogZjMyID0gZnJhY3Qoc2VlZCk7CgoJcmV0dXJuIG1peChyYW5kMUQoaSksIHJhbmQxRChpICsgMS4wKSwgc21vb3Roc3RlcCgwLjAsIDEuMCwgZikpOwp9CgpmbiBub2lzZTJEKHNlZWQ6IHZlYzJmKSAtPiBmMzIgewoJbGV0IGk6IHZlYzJmID0gZmxvb3Ioc2VlZCk7CglsZXQgZjogdmVjMmYgPSBmcmFjdChzZWVkKTsKCglsZXQgYTogZjMyID0gcmFuZDJEKGkpOwoJbGV0IGI6IGYzMiA9IHJhbmQyRChpICsgdmVjMmYoMS4wLCAwLjApKTsKCWxldCBjOiBmMzIgPSByYW5kMkQoaSArIHZlYzJmKDAuMCwgMS4wKSk7CglsZXQgZDogZjMyID0gcmFuZDJEKGkgKyB2ZWMyZigxLjAsIDEuMCkpOwoKCWxldCB1OiB2ZWMyZiA9IHNtb290aHN0ZXAodmVjMmYoMC4wKSwgdmVjMmYoMS4wKSwgZik7CgoJcmV0dXJuIG1peChhLCBiLCB1LngpICsgKGMgLSBhKSAqIHUueSAqICgxLjAgLSB1LngpICsgKGQgLSBiKSAqIHUueCAqIHUueTsKfQoKZm4gbm9pc2UyREZyZXEoc2VlZDogdmVjMmYsIGZyZXE6IGYzMikgLT4gZjMyIHsKCWxldCB1bml0OiBmMzIgPSBmMzIocmVzb2x1dGlvbi54KSAvIGZyZXE7CglsZXQgaWo6IHZlYzJmID0gZmxvb3Ioc2VlZCAvIHVuaXQpOwoJdmFyIHh5OiB2ZWMyZiA9IHZlYzJmKGdsc2xtb2Qoc2VlZC54LCB1bml0KSwgZ2xzbG1vZChzZWVkLnksIHVuaXQpKSAvIHVuaXQ7Cgl4eSA9IDAuNSAqICgxLjAgLSBjb3MoTV9QSSAqIHh5KSk7CgoJbGV0IGE6IGYzMiA9IHJhbmQyRChpaik7CglsZXQgYjogZjMyID0gcmFuZDJEKGlqICsgdmVjMmYoMS4wLCAwLjApKTsKCWxldCBjOiBmMzIgPSByYW5kMkQoaWogKyB2ZWMyZigwLjAsIDEuMCkpOwoJbGV0IGQ6IGYzMiA9IHJhbmQyRChpaiArIHZlYzJmKDEuMCwgMS4wKSk7CgoJbGV0IHgxOiBmMzIgPSBtaXgoYSwgYiwgeHkueCk7CglsZXQgeDI6IGYzMiA9IG1peChjLCBkLCB4eS54KTsKCglyZXR1cm4gbWl4KHgxLCB4MiwgeHkueSk7Cn0KCmZuIGZibShwOiB2ZWMyZikgLT4gZjMyIHsKCWxldCBjYSA9IGNvcyhNX1BJIC8gNC4wKTsKCWxldCBzYSA9IHNpbihNX1BJIC8gNC4wKTsKCXZhciBwdG1wOiB2ZWMyZiA9IHA7Cgl2YXIgcmVzOiBmMzIgPSAwLjA7Cgl2YXIgYW1wOiBmMzIgPSAwLjU7CglsZXQgZnJlcTogZjMyID0gMS45NTsKCWZvcih2YXIgaTogdTMyID0gMHU7IGkgPCAydTsgaSsrKSB7CgkJcmVzICs9IGFtcCAqIG5vaXNlMkQocHRtcCk7CgkJYW1wICo9IDAuNTsKCQlwdG1wID0gcHRtcCAqIGZyZXEgKiBtYXQyeDJmKGNhLCAtc2EsIHNhLCBjYSkgLSByZXMgKiAwLjQ7Cgl9CgoJcmV0dXJuIHJlczsKfQoKLy8gU2hhcGVzCi8vIFNwaGVyZQovLyByID0gcmFkaXVzCmZuIHNoU3BoZXJlKHA6IHZlYzNmLCByOiBmMzIpIC0+IGYzMiB7CglyZXR1cm4gbGVuZ3RoKHApIC0gcjsKfQoKLy8gUXVhZAovLyBhID0gZmlyc3QgdmVydGV4Ci8vIGIgPSBzZWNvbmQgdmVydGV4Ci8vIGMgPSB0aGlyZCB2ZXJ0ZXgKLy8gZCA9IGZvdXJ0aCB2ZXJ0ZXgKZm4gc2hRdWFkKHA6IHZlYzNmLCBhOiB2ZWMzZiwgYjogdmVjM2YsIGM6IHZlYzNmLCBkOiB2ZWMzZikgLT4gZjMyIHsKCWxldCBiYTogdmVjM2YgPSBiIC0gYTsKCWxldCBwYTogdmVjM2YgPSBwIC0gYTsKCWxldCBjYjogdmVjM2YgPSBjIC0gYjsKCWxldCBwYjogdmVjM2YgPSBwIC0gYjsKCWxldCBkYzogdmVjM2YgPSBkIC0gYzsKCWxldCBwYzogdmVjM2YgPSBwIC0gYzsKCWxldCBhZDogdmVjM2YgPSBhIC0gZDsKCWxldCBwZDogdmVjM2YgPSBwIC0gZDsKCWxldCBuOiB2ZWMzZiA9IGNyb3NzKGJhLCBhZCk7CglsZXQgcGJhOiB2ZWMzZiA9IGJhICogY2xhbXAoZG90KGJhLCBwYSkgLyBkb3QoYmEsIGJhKSwgMC4wLCAxLjApIC0gcGE7CglsZXQgcGNiOiB2ZWMzZiA9IGNiICogY2xhbXAoZG90KGNiLCBwYikgLyBkb3QoY2IsIGNiKSwgMC4wLCAxLjApIC0gcGI7CglsZXQgcGRjOiB2ZWMzZiA9IGRjICogY2xhbXAoZG90KGRjLCBwYykgLyBkb3QoZGMsIGRjKSwgMC4wLCAxLjApIC0gcGM7CglsZXQgcGFkOiB2ZWMzZiA9IGFkICogY2xhbXAoZG90KGFkLCBwZCkgLyBkb3QoYWQsIGFkKSwgMC4wLCAxLjApIC0gcGQ7CgoJaWYgKChzaWduKGRvdChjcm9zcyhiYSwgbiksIHBhKSkgKwoJc2lnbihkb3QoY3Jvc3MoY2IsIG4pLCBwYikpICsKCXNpZ24oZG90KGNyb3NzKGRjLCBuKSwgcGMpKSArCglzaWduKGRvdChjcm9zcyhhZCwgbiksIHBkKSkpIDwgMy4wKSB7CgkJcmV0dXJuIHNxcnQobWluKG1pbihtaW4oZG90KHBiYSwgcGJhKSwgZG90KHBjYiwgcGNiKSksIGRvdChwZGMsIHBkYykpLCBkb3QocGFkLCBwYWQpKSk7Cgl9CgllbHNlIHsKCQlsZXQgbmRvdHBhOiBmMzIgPSBkb3QobiwgcGEpOwoJCXJldHVybiBzcXJ0KG5kb3RwYSAqIG5kb3RwYSAvIGRvdChuLCBuKSk7Cgl9Cn0KCi8vIEluZmluaXRlIHBsYW5lCi8vIG4gPSBub3JtYWwsIG11c3QgYmUgbm9ybWFsaXplZAovLyBkaXN0ID0gZGlzdGFuY2UgZnJvbSB0aGUgb3JpZ2luCmZuIHNoUGxhbmUocDogdmVjM2YsIG46IHZlYzNmLCBkaXN0OiBmMzIpIC0+IGYzMiB7CglyZXR1cm4gZG90KHAsIG4pICsgZGlzdDsKfQoKLy8gQm94Ci8vIGIgPSBsZW5ndGgsIGhlaWdodCBhbmQgd2lkdGggb2YgdGhlIGJveApmbiBzaEJveChwOiB2ZWMzZiwgYjogdmVjM2YpIC0+IGYzMiB7CglsZXQgZDogdmVjM2YgPSBhYnMocCkgLSBiOwoKCXJldHVybiBsZW5ndGgobWF4KGQsIHZlYzNmKDAuMCkpKSArIG1pbihtYXgobWF4KGQueCwgZC55KSwgZC56KSwgMC4wKTsKfQoKLy8gSW5maW5pdGUgYm94Ci8vIGIgPSBkZXBlbmRzIG9uIHAsIGNhbiByZXByZXNlbnQgbGVuZ3RoLCBoZWlnaHQgYW5kIHdpZHRoCmZuIHNoQm94MihwOiB2ZWMyZiwgYjogdmVjMmYpIC0+IGYzMiB7CglsZXQgZDogdmVjMmYgPSBhYnMocCkgLSBiOwoKCXJldHVybiBsZW5ndGgobWF4KGQsIHZlYzJmKDAuMCkpKSArIG1pbihtYXgoZC54LCBkLnkpLCAwLjApOwp9CgovLyBUcmlhbmdsZQovLyBhID0gZmlyc3QgdmVydGV4Ci8vIGIgPSBzZWNvbmQgdmVydGV4Ci8vIGMgPSB0aGlyZCB2ZXJ0ZXgKZm4gc2hUcmlhbmdsZShwOiB2ZWMzZiwgYTogdmVjM2YsIGI6IHZlYzNmLCBjOiB2ZWMzZikgLT4gZjMyIHsKCWxldCBiYTogdmVjM2YgPSBiIC0gYTsKCWxldCBwYTogdmVjM2YgPSBwIC0gYTsKCWxldCBjYjogdmVjM2YgPSBjIC0gYjsKCWxldCBwYjogdmVjM2YgPSBwIC0gYjsKCWxldCBhYzogdmVjM2YgPSBhIC0gYzsKCWxldCBwYzogdmVjM2YgPSBwIC0gYzsKCWxldCBuOiB2ZWMzZiA9IGNyb3NzKGJhLCBhYyk7CglsZXQgcGJhOiB2ZWMzZiA9IGJhICogY2xhbXAoZG90KGJhLCBwYSkgLyBkb3QoYmEsIGJhKSwgMC4wLCAxLjApIC0gcGE7CglsZXQgcGNiOiB2ZWMzZiA9IGNiICogY2xhbXAoZG90KGNiLCBwYikgLyBkb3QoY2IsIGNiKSwgMC4wLCAxLjApIC0gcGI7CglsZXQgcGFjOiB2ZWMzZiA9IGFjICogY2xhbXAoZG90KGFjLCBwYykgLyBkb3QoYWMsIGFjKSwgMC4wLCAxLjApIC0gcGM7CgoJaWYgKChzaWduKGRvdChjcm9zcyhiYSwgbiksIHBhKSkgKwoJc2lnbihkb3QoY3Jvc3MoY2IsIG4pLCBwYikpICsKCXNpZ24oZG90KGNyb3NzKGFjLCBuKSwgcGMpKSkgPCAyLjApIHsKCQlyZXR1cm4gc3FydChtaW4obWluKGRvdChwYmEsIHBiYSksIGRvdChwY2IsIHBjYikpLCBkb3QocGFjLCBwYWMpKSk7Cgl9CgllbHNlIHsKCQlsZXQgbmRvdHBhOiBmMzIgPSBkb3QobiwgcGEpOwoJCXJldHVybiBzcXJ0KG5kb3RwYSAqIG5kb3RwYSAvIGRvdChuLCBuKSk7Cgl9Cn0KCi8vIFRyaWFuZ3VsYXIgcHJpc20KZm4gc2hUcmlhbmd1bGFyUHJpc20ocDogdmVjM2YsIGg6IHZlYzJmKSAtPiBmMzIgewoJbGV0IHE6IHZlYzNmID0gYWJzKHApOwoKCXJldHVybiBtYXgocS56IC0gaC55LCBtYXgocS54ICogMC44NjYwMjUgKyBwLnkgKiAwLjUsIC1wLnkpIC0gaC54ICogMC41KTsKfQoKLy8gQ29uZQovLyBzYyA9IChzaW4gb2YgdGhlIGFuZ2xlLCBjb3Mgb2YgdGhlIGFuZ2xlKQovLyBoID0gaGVpZ2h0CmZuIHNoQ29uZShwOiB2ZWMzZiwgc2M6IHZlYzJmLCBoOiBmMzIpIC0+IGYzMiB7CglsZXQgcTogdmVjMmYgPSBoICogdmVjMmYoc2MueCAvIHNjLnksIC0xLjApOwoJbGV0IHc6IHZlYzJmID0gdmVjMmYobGVuZ3RoKHAueHopLCBwLnkpOwoJbGV0IGE6IHZlYzJmID0gdyAtIHEgKiBjbGFtcChkb3QodywgcSkgLyBkb3QocSwgcSksIDAuMCwgMS4wKTsKCWxldCBiOiB2ZWMyZiA9IHcgLSBxICogdmVjMmYoY2xhbXAody54IC8gcS54LCAwLjAsIDEuMCkpOwoJbGV0IGs6IGYzMiA9IHNpZ24ocS55KTsKCWxldCBkOiBmMzIgPSBtaW4oZG90KGEsIGEpLCBkb3QoYiwgYikpOwoJbGV0IHM6IGYzMiA9IG1heChrICogKHcueCAqIHEueSAtIHcueSAqIHEueCksIGsgKiAody55ICogcS55KSk7CgoJcmV0dXJuIHNpZ24ocykgKiBzcXJ0KGQpOwp9CgovLyBDeWxpbmRlcgovLyByID0gcmFkaXVzCi8vIGggPSBoZWlnaHQKZm4gc2hDeWxpbmRlcihwOiB2ZWMzZiwgcjogZjMyLCBoOiBmMzIpIC0+IGYzMiB7CglsZXQgZDogZjMyID0gbGVuZ3RoKHAueHopIC0gcjsKCQoJcmV0dXJuIG1heChkLCBhYnMocC55KSAtIGgpOwp9CgovLyBUb3J1cwovLyByID0gcmFkaXVzCi8vIGQgPSBkaXN0YW5jZSB0byB0aGUgY2VudGVyCmZuIHNoVG9ydXMocDogdmVjM2YsIHI6IGYzMiwgZDogZjMyKSAtPiBmMzIgewoJcmV0dXJuIGxlbmd0aCh2ZWMyKGxlbmd0aChwLnh6KSAtIGQsIHAueSkpIC0gcjsKfQoKLy8gQ2FwcGVkIFRvcnVzCi8vIHNjID0gKHNpbiBvZiB0aGUgYW5nbGUsIGNvcyBvZiB0aGUgYW5nbGUpCi8vIHIgPSByYWRpdXMKLy8gZCA9IGRpc3RhbmNlIHRvIHRoZSBjZW50ZXIKZm4gc2hDYXBwZWRUb3J1cyhwOiB2ZWMzZiwgc2M6IHZlYzJmLCByOiBmMzIsIGQ6IGYzMikgLT4gZjMyIHsKCWxldCBwMjogdmVjM2YgPSB2ZWMzZihhYnMocC54KSwgcC55eik7Cgl2YXIgazogZjMyOwoJaWYgKChzYy55ICogcDIueCkgPiAoc2MueCAqIHAyLnkpKSB7CgkJayA9IGRvdChwMi54eSwgc2MpOwoJfQoJZWxzZSB7CgkJayA9IGxlbmd0aChwMi54eSk7Cgl9CgoJcmV0dXJuIHNxcnQoZG90KHAyLCBwMikgKyBkICogZCAtIDIuMCAqIGQgKiBrKSAtIHI7CQp9CgovLyBMaW5rIGluIGEgY2hhaW4KLy8gbCA9IGxlbmd0aAovLyByID0gcmFkaXVzCi8vIGQgPSBkaXN0YW5jZSB0byB0aGUgY2VudGVyCmZuIHNoTGluayhwOiB2ZWMzZiwgbDogZjMyLCByOiBmMzIsIGQ6IGYzMikgLT4gZjMyIHsKCWxldCBxOiB2ZWMzZiA9IHZlYzNmKHAueCwgbWF4KGFicyhwLnkpIC0gbCwgMC4wKSwgcC56KTsKCglyZXR1cm4gbGVuZ3RoKHZlYzIobGVuZ3RoKHEueHkpIC0gZCwgcS56KSkgLSByOwp9CgovLyBPcGVyYXRpb25zCmZuIG9wVW5pb24oYTogT2JqZWN0LCBiOiBPYmplY3QpIC0+IE9iamVjdCB7CglpZiAoYS5kaXN0IDwgYi5kaXN0KSB7CgkJcmV0dXJuIGE7Cgl9CgllbHNlIHsKCQlyZXR1cm4gYjsKCX0KfQoKZm4gb3BTbW9vdGhVbmlvbihhOiBPYmplY3QsIGI6IE9iamVjdCwgazogZjMyKSAtPiBPYmplY3QgewoJbGV0IGg6IGYzMiA9IG1heChrIC0gYWJzKGEuZGlzdCAtIGIuZGlzdCksIDAuMCk7CglsZXQgbmV3RGlzdDogZjMyID0gbWluKGEuZGlzdCwgYi5kaXN0KSAtIGggKiBoICogMC4yNSAvIGs7CgoJbGV0IGJmOiBmMzIgPSAoaCAvIGspICogKGggLyBrKSAqIDAuNTsKCXZhciBibGVuZEZhY3RvcjogZjMyOwoJaWYgKGEuZGlzdCA8IGIuZGlzdCkgewoJCWJsZW5kRmFjdG9yID0gYmY7Cgl9CgllbHNlIHsKCQlibGVuZEZhY3RvciA9ICgxLjAgLSBiZik7Cgl9CgoJbGV0IG5ld01hdDogTWF0ZXJpYWwgPSBNYXRlcmlhbChtaXgoYS5tYXQuZGlmZnVzZSwgYi5tYXQuZGlmZnVzZSwgYmxlbmRGYWN0b3IpLCBtaXgoYS5tYXQubWV0YWxsaWNSb3VnaG5lc3MsIGIubWF0Lm1ldGFsbGljUm91Z2huZXNzLCBibGVuZEZhY3RvcikpOwoKCXJldHVybiBPYmplY3QobmV3RGlzdCwgbmV3TWF0KTsKfQoKZm4gb3BJbnRlcnNlY3Rpb24oYTogT2JqZWN0LCBiOiBPYmplY3QpIC0+IE9iamVjdCB7CglpZiAoYS5kaXN0ID4gYi5kaXN0KSB7CgkJcmV0dXJuIGE7Cgl9CgllbHNlIHsKCQlyZXR1cm4gYjsKCX0KfQoKZm4gb3BTbW9vdGhJbnRlcnNlY3Rpb24oYTogT2JqZWN0LCBiOiBPYmplY3QsIGs6IGYzMikgLT4gT2JqZWN0IHsKCXZhciBvYmplY3Q6IE9iamVjdCA9IG9wU21vb3RoVW5pb24oT2JqZWN0KC1hLmRpc3QsIGEubWF0KSwgT2JqZWN0KC1iLmRpc3QsIGIubWF0KSwgayk7CglvYmplY3QuZGlzdCAqPSAtMS4wOwoKCXJldHVybiBvYmplY3Q7Cn0KCmZuIG9wRGlmZmVyZW5jZShhOiBPYmplY3QsIGI6IE9iamVjdCkgLT4gT2JqZWN0IHsKCWlmIChhLmRpc3QgPiAtYi5kaXN0KSB7CgkJcmV0dXJuIGE7Cgl9CgllbHNlIHsKCQlyZXR1cm4gT2JqZWN0KC1iLmRpc3QsIGIubWF0KTsKCX0KfQoKZm4gb3BTbW9vdGhEaWZmZXJlbmNlKGE6IE9iamVjdCwgYjogT2JqZWN0LCBrOiBmMzIpIC0+IE9iamVjdCB7Cgl2YXIgb2JqZWN0OiBPYmplY3QgPSBvcFNtb290aFVuaW9uKGIsIE9iamVjdCgtYS5kaXN0LCBhLm1hdCksIGspOwoJb2JqZWN0LmRpc3QgKj0gLTEuMDsKCglyZXR1cm4gb2JqZWN0Owp9CgpmbiBvcE1pbihvOiBPYmplY3QsIHg6IGYzMikgLT4gT2JqZWN0IHsKCXJldHVybiBPYmplY3QobWluKG8uZGlzdCwgeCksIG8ubWF0KTsKfQoKZm4gb3BNYXgobzogT2JqZWN0LCB4OiBmMzIpIC0+IE9iamVjdCB7CglyZXR1cm4gT2JqZWN0KG1heChvLmRpc3QsIHgpLCBvLm1hdCk7Cn0KCmZuIG9wUm91bmQobzogT2JqZWN0LCByOiBmMzIpIC0+IE9iamVjdCB7CglyZXR1cm4gT2JqZWN0KG8uZGlzdCAtIHIsIG8ubWF0KTsKfQoKZm4gb3BPbmlvbihvOiBPYmplY3QsIHQ6IGYzMikgLT4gT2JqZWN0IHsKCXJldHVybiBPYmplY3QoYWJzKG8uZGlzdCkgLSB0LCBvLm1hdCk7Cn0KCi8vIFRyYW5zZm9ybQpmbiByb3RhdGUocDogdmVjMmYsIGFuZ2xlOiBmMzIpIC0+IHZlYzJmIHsKCXJldHVybiBjb3MoYW5nbGUpICogcCArIHNpbihhbmdsZSkgKiB2ZWMyZihwLnksIC1wLngpOwp9CgovLyBSYXkgSW5maW5pdGUgUmVwZWF0Ci8vIHAgPSByYXkgcG9zaXRpb24KLy8gbiA9IHBlcmlvZCBvbiBlYWNoIGF4aXMKZm4gcmF5UmVwZWF0KHA6IHZlYzNmLCBuOiB2ZWMzZikgLT4gdmVjM2YgewoJcmV0dXJuIHZlYzNmKGdsc2xtb2QocC54LCBuLngpLCBnbHNsbW9kKHAueSwgbi55KSwgZ2xzbG1vZChwLnosIG4ueikpIC0gKG4gLyAyLjApOwp9CgovLyBSYXkgRmluaXRlIFJlcGVhdAovLyBwID0gcmF5IHBvc2l0aW9uCi8vIG4gPSBwZXJpb2Qgb24gZWFjaCBheGlzCi8vIGwgPSBudW1iZXIgb2YgcmVwZXRpdGlvbnMgb24gZWFjaCBheGlzCmZuIHJheUZpbml0ZVJlcGVhdChwOiB2ZWMzZiwgbjogZjMyLCBsOiB2ZWMzZikgLT4gdmVjM2YgewoJcmV0dXJuIHAgLSBuICogY2xhbXAocm91bmQocCAvIG4pLCAtbCwgbCk7Cn0KCmZuIGRpc3BsYWNlKHA6IHZlYzNmKSAtPiBmMzIgewoJcmV0dXJuIHNpbihwLnggKyA0LjAgKiB0aW1lKSAqIHNpbihwLnkgKyBzaW4oMi4wICogdGltZSkpICogc2luKHAueiArIDYuMCAqIHRpbWUpOwp9CgovLyBTY2VuZQpmbiBzY2VuZShwOiB2ZWMzZikgLT4gT2JqZWN0IHsKCWxldCBzcGhlcmU6IE9iamVjdCA9IE9iamVjdChzaFNwaGVyZShwIC0gdmVjM2YoMC4wLCAwLjAsIDEuMCksIDAuMjUpLCBNYXRlcmlhbCh2ZWMzZigxLjAsIDAuMCwgMC4wKSwgdmVjMmYoMC41LCAwLjUpKSk7CgoJcmV0dXJuIHNwaGVyZTsKfQoKLy8gQmFja2dyb3VuZApmbiBiYWNrZ3JvdW5kKHA6IHZlYzNmKSAtPiB2ZWMzZiB7CglyZXR1cm4gdmVjM2YoMC4wMDUsIDAuMDA1LCAwLjAwNSk7Cn0KCi8vIENhbWVyYQpjb25zdCB1cDogdmVjM2YgPSB2ZWMzZigwLjAsIDEuMCwgMC4wKTsKCmZuIGNhbWVyYSgpIC0+IG1hdDN4M2YgewoJbGV0IGZvcndhcmQ6IHZlYzNmID0gbm9ybWFsaXplKGNhbWVyYURpcmVjdGlvbik7CglsZXQgcmlnaHQ6IHZlYzNmID0gbm9ybWFsaXplKGNyb3NzKHVwLCBmb3J3YXJkKSk7CglsZXQgcmVhbFVwOiB2ZWMzZiA9IGNyb3NzKGZvcndhcmQsIHJpZ2h0KTsKCglyZXR1cm4gbWF0M3gzZihyaWdodCwgcmVhbFVwLCBmb3J3YXJkKTsKfQoKLy8gTGlnaHRzCmNvbnN0IExJR0hUU19DT1VOVDogdTMyID0gMXU7CmZuIGxpZ2h0cygpIC0+IGFycmF5PExpZ2h0LCBMSUdIVFNfQ09VTlQ+IHsKCXZhciBsOiBhcnJheTxMaWdodCwgTElHSFRTX0NPVU5UPjsKCWxbMF0gPSBMaWdodCgwdSwgdmVjM2YoMC4wKSwgdmVjM2Yoc2luKHRpbWUpLCAtMS4wLCBjb3ModGltZSkpLCB2ZWMzZigxLjAsIDEuMCwgMS4wKSwgdmVjMmYoMC4wKSk7CgkKCXJldHVybiBsOwp9CgpmbiByYXltYXJjaChvOiB2ZWMzZiwgZDogdmVjM2YpIC0+IE9iamVjdCB7Cgl2YXIgb2JqZWN0OiBPYmplY3QgPSBPYmplY3QoMC4wLCBNYXRlcmlhbCh2ZWMzZigwLjApLCB2ZWMyZigwLjApKSk7Cglmb3IgKHZhciBpOiB1MzIgPSAwdTsgaSA8IE1BWF9TVEVQUzsgaSsrKSB7CgkJbGV0IHA6IHZlYzNmID0gbyArIG9iamVjdC5kaXN0ICogZDsKCQlsZXQgb2JqZWN0SGl0OiBPYmplY3QgPSBzY2VuZShwKTsKCQlpZiAoYWJzKG9iamVjdEhpdC5kaXN0KSA8IEVQU0lMT04pIHsKCQkJYnJlYWs7CgkJfQoJCW9iamVjdC5kaXN0ICs9IG9iamVjdEhpdC5kaXN0OwoJCW9iamVjdC5tYXQgPSBvYmplY3RIaXQubWF0OwoJCWlmIChvYmplY3QuZGlzdCA+IE1BWF9ESVNUQU5DRSkgewoJCQlicmVhazsKCQl9Cgl9CgoJcmV0dXJuIG9iamVjdDsKfQoKLy8gQ29tcHV0ZSBub3JtYWwKZm4gbm9ybWFsKHA6IHZlYzNmKSAtPiB2ZWMzZiB7CglsZXQgZTogdmVjMmYgPSB2ZWMyZihFUFNJTE9OLCAwLjApOwoJbGV0IG46IHZlYzNmID0gdmVjM2Yoc2NlbmUocCkuZGlzdCkgLSB2ZWMzZihzY2VuZShwIC0gZS54eXkpLmRpc3QsIHNjZW5lKHAgLSBlLnl4eSkuZGlzdCwgc2NlbmUocCAtIGUueXl4KS5kaXN0KTsKCglyZXR1cm4gbm9ybWFsaXplKG4pOwp9CgovLyBCUkRGCmZuIGRpc3RyaWJ1dGlvbihOZG90SDogZjMyLCByb3VnaG5lc3M6IGYzMikgLT4gZjMyIHsKCWxldCBhOiBmMzIgPSByb3VnaG5lc3MgKiByb3VnaG5lc3M7CglsZXQgYVNxdWFyZTogZjMyID0gYSAqIGE7CglsZXQgTmRvdEhTcXVhcmU6IGYzMiA9IE5kb3RIICogTmRvdEg7CglsZXQgZGVub206IGYzMiA9IE5kb3RIU3F1YXJlICogKGFTcXVhcmUgLSAxLjApICsgMS4wOwoKCXJldHVybiBhU3F1YXJlIC8gKE1fUEkgKiBkZW5vbSAqIGRlbm9tKTsKfQoKZm4gZnJlc25lbChjb3NUaGV0YTogZjMyLCBmMDogdmVjM2YpIC0+IHZlYzNmIHsKCXJldHVybiBmMCArICgxLjAgLSBmMCkgKiBwb3coMS4wIC0gY29zVGhldGEsIDUuMCk7Cn0KCmZuIGcoTmRvdFY6IGYzMiwgcm91Z2huZXNzOiBmMzIpIC0+IGYzMiB7CglsZXQgcjogZjMyID0gcm91Z2huZXNzICsgMS4wOwoJbGV0IGs6IGYzMiA9IChyICogcikgLyA4LjA7CglsZXQgZGVub206IGYzMiA9IE5kb3RWICogKDEuMCAtIGspICsgazsKCglyZXR1cm4gTmRvdFYgLyBkZW5vbTsKfQoKZm4gc21pdGgoTGRvdE46IGYzMiwgVmRvdE46IGYzMiwgcm91Z2huZXNzOiBmMzIpIC0+IGYzMiB7CglsZXQgZ3Y6IGYzMiA9IGcoVmRvdE4sIHJvdWdobmVzcyk7CglsZXQgZ2w6IGYzMiA9IGcoTGRvdE4sIHJvdWdobmVzcyk7CgoJcmV0dXJuIGd2ICogZ2w7Cn0KCmZuIGRpZmZ1c2VGcmVzbmVsQ29ycmVjdGlvbihpb3I6IHZlYzNmKSAtPiB2ZWMzZiB7CglsZXQgaW9yU3F1YXJlOiB2ZWMzZiA9IGlvciAqIGlvcjsKCXZhciBUSVI6IHZlYzNmOwoJaWYgKGlvci54IDwgMS4wKSB7CgkJVElSLnggPSAxLjA7Cgl9CgllbHNlIHsKCQlUSVIueCA9IDAuMDsKCX0KCWlmIChpb3IueSA8IDEuMCkgewoJCVRJUi55ID0gMS4wOwoJfQoJZWxzZSB7CgkJVElSLnkgPSAwLjA7Cgl9CglpZiAoaW9yLnogPCAxLjApIHsKCQlUSVIueiA9IDEuMDsKCX0KCWVsc2UgewoJCVRJUi56ID0gMC4wOwoJfQoJbGV0IGludkRlbnVtOiB2ZWMzZiA9IG1peCh2ZWMzZigxLjApLCB2ZWMzZigxLjApIC8gKGlvclNxdWFyZSAqIGlvclNxdWFyZSAqICh2ZWMzZig1NTQuMzMpICogMzgwLjcgKiBpb3IpKSwgVElSKTsKCXZhciBudW06IHZlYzNmID0gaW9yICogbWl4KHZlYzNmKDAuMTkyMTE1NjEwMjI1MTA4OCksIGlvciAqIDI5OC4yNSAtIDI2MS4zOCAqIGlvclNxdWFyZSArIDEzOC40MywgVElSKTsKCW51bSArPSBtaXgodmVjM2YoMC44MDc4ODQzODk3NzQ4OTEyKSwgdmVjM2YoLTEuMDcpLCBUSVIpOwoKCXJldHVybiBudW0gKiBpbnZEZW51bTsKfQoKZm4gYnJkZihMZG90SDogZjMyLCBOZG90SDogZjMyLCBWZG90SDogZjMyLCBMZG90TjogZjMyLCBWZG90TjogZjMyLCBkaWZmdXNlOiB2ZWMzZiwgbWV0YWxsaWM6IGYzMiwgcm91Z2huZXNzOiBmMzIpIC0+IHZlYzNmIHsKCWxldCBkOiBmMzIgPSBkaXN0cmlidXRpb24oTmRvdEgsIHJvdWdobmVzcyk7CglsZXQgZjogdmVjM2YgPSBmcmVzbmVsKExkb3RILCBtaXgodmVjM2YoMC4wNCksIGRpZmZ1c2UsIG1ldGFsbGljKSk7CglsZXQgZlQ6IHZlYzNmID0gZnJlc25lbChMZG90TiwgbWl4KHZlYzNmKDAuMDQpLCBkaWZmdXNlLCBtZXRhbGxpYykpOwoJbGV0IGZUSVI6IHZlYzNmID0gZnJlc25lbChWZG90TiwgbWl4KHZlYzNmKDAuMDQpLCBkaWZmdXNlLCBtZXRhbGxpYykpOwoJbGV0IGc6IGYzMiA9IHNtaXRoKExkb3ROLCBWZG90Tiwgcm91Z2huZXNzKTsKCWxldCBkZmM6IHZlYzNmID0gZGlmZnVzZUZyZXNuZWxDb3JyZWN0aW9uKHZlYzNmKDEuMDUpKTsKCglsZXQgbGFtYmVydGlhbjogdmVjM2YgPSBkaWZmdXNlIC8gTV9QSTsKCglyZXR1cm4gKGQgKiBmICogZykgLyBtYXgoNC4wICogTGRvdE4gKiBWZG90TiwgMC4wMDEpICsgKCh2ZWMzZigxLjApIC0gZlQpICogKHZlYzNmKDEuMCAtIGZUSVIpKSAqIGxhbWJlcnRpYW4pICogZGZjOwp9CgpmbiBzaGFkZShwOiB2ZWMzZiwgZDogdmVjM2YsIG46IHZlYzNmLCBsaWdodFBvczogdmVjM2YsIGxpZ2h0Q29sb3I6IHZlYzNmLCBkaWZmdXNlOiB2ZWMzZiwgbWV0YWxsaWM6IGYzMiwgcm91Z2huZXNzOiBmMzIpIC0+IHZlYzNmIHsKCWxldCBsOiB2ZWMzZiA9IG5vcm1hbGl6ZShsaWdodFBvcyAtIHApOwoJbGV0IHY6IHZlYzNmID0gLWQ7CglsZXQgaDogdmVjM2YgPSBub3JtYWxpemUodiArIGwpOwoKCWxldCBMZG90SDogZjMyID0gbWF4KGRvdChsLCBoKSwgMC4wKTsKCWxldCBOZG90SDogZjMyID0gbWF4KGRvdChuLCBoKSwgMC4wKTsKCWxldCBWZG90SDogZjMyID0gbWF4KGRvdCh2LCBoKSwgMC4wKTsKCWxldCBMZG90TjogZjMyID0gbWF4KGRvdChsLCBuKSwgMC4wKTsKCWxldCBWZG90TjogZjMyID0gbWF4KGRvdCh2LCBuKSwgMC4wKTsKCglsZXQgYnJkZjogdmVjM2YgPSBicmRmKExkb3RILCBOZG90SCwgVmRvdEgsIExkb3ROLCBWZG90TiwgZGlmZnVzZSwgbWV0YWxsaWMsIHJvdWdobmVzcyk7CgkKCXJldHVybiBsaWdodENvbG9yICogYnJkZiAqIExkb3ROOwp9CgovLyBTaGFkb3dzCmZuIHNoYWRvd3MocDogdmVjM2YsIG46IHZlYzNmLCBsaWdodFBvczogdmVjM2YpIC0+IGYzMiB7Cgl2YXIgcmVzOiBmMzIgPSAxLjA7Cgl2YXIgZGlzdDogZjMyID0gMC4wMTsKCWxldCBsaWdodFNpemU6IGYzMiA9IDAuMTU7Cglmb3IgKHZhciBpOiB1MzIgPSAwdTsgaSA8IE1BWF9TVEVQUzsgaSsrKSB7CgkJbGV0IGhpdDogZjMyID0gc2NlbmUocCArIGxpZ2h0UG9zICogZGlzdCkuZGlzdDsKCQlyZXMgPSBtaW4ocmVzLCBoaXQgLyAoZGlzdCAqIGxpZ2h0U2l6ZSkpOwoJCWRpc3QgKz0gaGl0OwoJCWlmIChoaXQgPCBFUFNJTE9OIHx8IGRpc3QgPiA2MC4wKSB7CgkJCWJyZWFrOwoJCX0KCX0KCglyZXR1cm4gY2xhbXAocmVzLCAwLjAsIDEuMCk7Cn0KCi8vIEFtYmllbnQgT2NjbHVzaW9uCmZuIGFtYmllbnRPY2NsdXNpb24ocDogdmVjM2YsIG46IHZlYzNmKSAtPiBmMzIgewoJdmFyIGFvOiBmMzIgPSAwLjA7Cgl2YXIgd2VpZ2h0OiBmMzIgPSAxLjA7Cglmb3IgKHZhciBpOiB1MzIgPSAwdTsgaSA8IDh1OyBpKyspIHsKCQlsZXQgbGVuOiBmMzIgPSAwLjAxICsgMC4wMiAqIGYzMihpICogaSk7CgkJbGV0IGRpc3Q6IGYzMiA9IHNjZW5lKHAgKyBuICogbGVuKS5kaXN0OwoJCWFvICs9IChsZW4gLSBkaXN0KSAqIHdlaWdodDsKCQl3ZWlnaHQgKj0gMC44NTsKCX0KCglyZXR1cm4gMS4wIC0gY2xhbXAoMC42ICogYW8sIDAuMCwgMS4wKTsKfQoKLy8gUmVuZGVyCmZuIHJlbmRlcihvOiB2ZWMzZiwgZDogdmVjM2YpIC0+IHZlYzNmIHsKCXZhciB0bXBvOiB2ZWMzZiA9IG87Cgl2YXIgdG1wZDogdmVjM2YgPSBkOwoKCXZhciBsaWdodHNMaXN0OiBhcnJheTxMaWdodCwgTElHSFRTX0NPVU5UPiA9IGxpZ2h0cygpOwoKCWxldCBmb2dEZW5zaXR5OiBmMzIgPSAwLjAwMDg7CgoJdmFyIGZyYWM6IGYzMiA9IDEuMDsKCXZhciBjb2xvcjogdmVjM2YgPSB2ZWMzZigwLjAsIDAuMCwgMC4wKTsKCWZvciAodmFyIGRlcHRoOiB1MzIgPSAwdTsgZGVwdGggPCBNQVhfQk9VTkNFUyArIDF1OyBkZXB0aCsrKSB7CgkJdmFyIGxvY2FsQ29sb3I6IHZlYzNmID0gdmVjM2YoMC4wLCAwLjAsIDAuMCk7CgoJCS8vIFJheW1hcmNoCgkJbGV0IG9iamVjdDogT2JqZWN0ID0gcmF5bWFyY2godG1wbywgdG1wZCk7CgkJbGV0IHA6IHZlYzNmID0gdG1wbyArIG9iamVjdC5kaXN0ICogdG1wZDsKCQkKCQlsZXQgbjogdmVjM2YgPSBub3JtYWwocCk7CgkJbGV0IG1ldGFsbGljOiBmMzIgPSBvYmplY3QubWF0Lm1ldGFsbGljUm91Z2huZXNzLng7CgkJaWYgKG9iamVjdC5kaXN0IDw9IE1BWF9ESVNUQU5DRSkgewoJCQkvLyBPYmplY3QgcHJvcGVydGllcwoJCQlsZXQgZGlmZnVzZTogdmVjM2YgPSBvYmplY3QubWF0LmRpZmZ1c2U7CgkJCWxldCByb3VnaG5lc3M6IGYzMiA9IG9iamVjdC5tYXQubWV0YWxsaWNSb3VnaG5lc3MueTsKCQkJbGV0IGFvOiBmMzIgPSBhbWJpZW50T2NjbHVzaW9uKHAsIG4pOwoKCQkJLy8gTG9jYWwgY29sb3IKCQkJZm9yICh2YXIgbGlnaHRJbmRleDogdTMyID0gMHU7IGxpZ2h0SW5kZXggPCBMSUdIVFNfQ09VTlQ7IGxpZ2h0SW5kZXgrKykgewoJCQkJLy8gRGlyZWN0aW9uYWwgTGlnaHQKCQkJCWlmIChsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmxpZ2h0VHlwZSA9PSAwdSkgewoJCQkJCWxldCBsOiB2ZWMzZiA9IG5vcm1hbGl6ZSgtbGlnaHRzTGlzdFtsaWdodEluZGV4XS5kaXJlY3Rpb24pOwoJCQkJCWxldCBsYzogdmVjM2YgPSBsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmNvbG9yOwoJCQkJCWxvY2FsQ29sb3IgKz0gc2hhZGUocCwgdG1wZCwgbiwgbCwgbGMsIGRpZmZ1c2UsIG1ldGFsbGljLCByb3VnaG5lc3MpICogc2hhZG93cyhwLCBuLCBsKTsKCQkJCX0KCQkJCS8vIFBvaW50IExpZ2h0CgkJCQllbHNlIGlmIChsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmxpZ2h0VHlwZSA9PSAxdSkgewoJCQkJCWxldCBsOiB2ZWMzZiA9IG5vcm1hbGl6ZShsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLnBvc2l0aW9uIC0gcCk7CgkJCQkJbGV0IGRpc3RhbmNlOiBmMzIgPSBsZW5ndGgobGlnaHRzTGlzdFtsaWdodEluZGV4XS5wb3NpdGlvbiAtIHApOwoJCQkJCWxldCBhdHRlbnVhdGlvbjogZjMyID0gMS4wIC8gKGRpc3RhbmNlICogZGlzdGFuY2UpOwoJCQkJCWxldCBsYzogdmVjM2YgPSBsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmNvbG9yICogYXR0ZW51YXRpb247CgkJCQkJbG9jYWxDb2xvciArPSBzaGFkZShwLCB0bXBkLCBuLCBsLCBsYywgZGlmZnVzZSwgbWV0YWxsaWMsIHJvdWdobmVzcykgKiBzaGFkb3dzKHAsIG4sIGwpOwoJCQkJfQoJCQkJLy8gU3BvdCBMaWdodAoJCQkJZWxzZSBpZiAobGlnaHRzTGlzdFtsaWdodEluZGV4XS5saWdodFR5cGUgPT0gMnUpIHsKCQkJCQlsZXQgbDogdmVjM2YgPSBub3JtYWxpemUobGlnaHRzTGlzdFtsaWdodEluZGV4XS5wb3NpdGlvbiAtIHApOwoJCQkJCWxldCBsZDogdmVjM2YgPSBsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmRpcmVjdGlvbjsKCQkJCQlsZXQgdGhldGE6IGYzMiA9IGRvdChsLCBub3JtYWxpemUoLWxkKSk7CgkJCQkJbGV0IGVwc2lsb246IGYzMiA9IGNvcyhsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmN1dG9mZnMueSAtIGxpZ2h0c0xpc3RbbGlnaHRJbmRleF0uY3V0b2Zmcy54KTsKCQkJCQlsZXQgaW50ZW5zaXR5OiBmMzIgPSBjbGFtcCgodGhldGEgLSBjb3MobGlnaHRzTGlzdFtsaWdodEluZGV4XS5jdXRvZmZzLngpKSAvIGVwc2lsb24sIDAuMCwgMS4wKTsKCQkJCQlsZXQgbGM6IHZlYzNmID0gbGlnaHRzTGlzdFtsaWdodEluZGV4XS5jb2xvcjsKCQkJCQlsb2NhbENvbG9yICs9IHNoYWRlKHAsIHRtcGQsIG4sIGwsIGxjICogaW50ZW5zaXR5LCBkaWZmdXNlICogaW50ZW5zaXR5LCBtZXRhbGxpYywgcm91Z2huZXNzKSAqIHNoYWRvd3MocCwgbiwgbCk7CgkJCQl9CgkJCX0KCQkJbG9jYWxDb2xvciAqPSBhbzsKCQkJbG9jYWxDb2xvciA9IG1peChsb2NhbENvbG9yLCBiYWNrZ3JvdW5kKHApLCAxLjAgLSBleHAoLWZvZ0RlbnNpdHkgKiBvYmplY3QuZGlzdCAqIG9iamVjdC5kaXN0KSk7CgkJfQoJCWVsc2UgewoJCQljb2xvciArPSBiYWNrZ3JvdW5kKHApICogZnJhYzsKCQkJcmV0dXJuIGNvbG9yOwoJCX0KCgkJY29sb3IgKz0gbG9jYWxDb2xvciAqIGZyYWM7CgkJZnJhYyAqPSBtZXRhbGxpYzsKCgkJLy8gRWFybHkgc3RvcCBhcyB0aGUgaW1wYWN0IG9uIHRoZSBmaW5hbCBjb2xvciB3aWxsIG5vdCBiZSBjb25zZXF1ZW50CgkJaWYgKGZyYWMgPCAwLjA1KSB7CgkJCWJyZWFrOwoJCX0KCgkJdG1wbyA9IHAgKyAobiAqIEVQU0lMT04pOwoJCXRtcGQgPSByZWZsZWN0KHRtcGQsIG4pOwoJfQoKCXJldHVybiBjb2xvcjsKfQoKQGZyYWdtZW50CmZuIG1haW4oQGxvY2F0aW9uKDApIHV2OiB2ZWMyZikgLT4gQGxvY2F0aW9uKDApIHZlYzRmIHsKCWxldCBjYW1lcmFNYXRyaXg6IG1hdDN4M2YgPSBjYW1lcmEoKTsKCglsZXQgZGltOiB2ZWMyZiA9IHZlYzJmKGYzMihyZXNvbHV0aW9uLngpLCBmMzIocmVzb2x1dGlvbi55KSk7CglsZXQgbmV3VXY6IHZlYzJmID0gKDIuMCAqICh1diAqIGRpbSkgLSBkaW0pIC8gZGltLnk7CglsZXQgZDogdmVjM2YgPSBjYW1lcmFNYXRyaXggKiBub3JtYWxpemUodmVjM2YobmV3VXYsIDIuMCkpOwoKCWxldCBjb2xvcjogdmVjM2YgPSByZW5kZXIoY2FtZXJhUG9zaXRpb24sIGQpOwoKCXJldHVybiB2ZWM0Zihjb2xvciwgMS4wKTsKfQ==)

### Creations
- [Weird Nutshell](https://www.team-nutshell.dev/shader/editor.html#Y29uc3QgTV9QSTogZjMyID0gMy4xNDE1OTI2NTM1ODk3OTMyMzg0NjI2NDMzODMyNzk1OwoKY29uc3QgTUFYX1NURVBTOiB1MzIgPSAyNTZ1Owpjb25zdCBNQVhfRElTVEFOQ0U6IGYzMiA9IDEwMDAuMDsKY29uc3QgRVBTSUxPTjogZjMyID0gMC4wMDAxOwpjb25zdCBNQVhfQk9VTkNFUzogdTMyID0gMXU7CgpzdHJ1Y3QgTWF0ZXJpYWwgewoJZGlmZnVzZTogdmVjM2YsCgltZXRhbGxpY1JvdWdobmVzczogdmVjMmYKfQoKc3RydWN0IE9iamVjdCB7CglkaXN0OiBmMzIsCgltYXQ6IE1hdGVyaWFsCn0KCnN0cnVjdCBMaWdodCB7CglsaWdodFR5cGU6IHUzMiwgLy8gMCA9IERpcmVjdGlvbmFsLCAxID0gUG9pbnQsIDIgPSBTcG90Cglwb3NpdGlvbjogdmVjM2YsCglkaXJlY3Rpb246IHZlYzNmLAoJY29sb3I6IHZlYzNmLAoJY3V0b2ZmczogdmVjMmYKfQoKLy8gR0xTTC10eXBlIG1vZCgpCmZuIGdsc2xtb2QoYTogZjMyLCBiOiBmMzIpIC0+IGYzMiB7Cgl2YXIgbTogZjMyID0gYSAlIGI7CglpZiAobSA8IDAuMCkgewoJCWlmIChiIDwgMC4wKSB7CgkJCW0gLT0gYjsKCQl9IGVsc2UgewoJCQltICs9IGI7CgkJfQoJfQoKCXJldHVybiBtOwp9CgovLyBSYW5kb20KZm4gcmFuZDJEKHNlZWQ6IHZlYzJmKSAtPiBmMzIgewoJcmV0dXJuIGZyYWN0KHNpbihkb3Qoc2VlZCwgdmVjMmYoMTIuOTg5OCwgNzguMjMzKSkpICogNDM3NTguNTQ1MzEyMyk7Cn0KCmZuIG5vaXNlMkQoc2VlZDogdmVjMmYpIC0+IGYzMiB7CglsZXQgaTogdmVjMmYgPSBmbG9vcihzZWVkKTsKCWxldCBmOiB2ZWMyZiA9IGZyYWN0KHNlZWQpOwoKCWxldCBhOiBmMzIgPSByYW5kMkQoaSk7CglsZXQgYjogZjMyID0gcmFuZDJEKGkgKyB2ZWMyZigxLjAsIDAuMCkpOwoJbGV0IGM6IGYzMiA9IHJhbmQyRChpICsgdmVjMmYoMC4wLCAxLjApKTsKCWxldCBkOiBmMzIgPSByYW5kMkQoaSArIHZlYzJmKDEuMCwgMS4wKSk7CgoJbGV0IHU6IHZlYzJmID0gc21vb3Roc3RlcCh2ZWMyZigwLjApLCB2ZWMyZigxLjApLCBmKTsKCglyZXR1cm4gbWl4KGEsIGIsIHUueCkgKyAoYyAtIGEpICogdS55ICogKDEuMCAtIHUueCkgKyAoZCAtIGIpICogdS54ICogdS55Owp9CgpmbiBmYm0ocDogdmVjMmYpIC0+IGYzMiB7CglsZXQgY2EgPSBjb3MoTV9QSSAvIDQuMCk7CglsZXQgc2EgPSBzaW4oTV9QSSAvIDQuMCk7Cgl2YXIgcHRtcDogdmVjMmYgPSBwOwoJdmFyIHJlczogZjMyID0gMC4wOwoJdmFyIGFtcDogZjMyID0gMC41OwoJbGV0IGZyZXE6IGYzMiA9IDEuOTU7Cglmb3IodmFyIGk6IHUzMiA9IDB1OyBpIDwgMnU7IGkrKykgewoJCXJlcyArPSBhbXAgKiBub2lzZTJEKHB0bXApOwoJCWFtcCAqPSAwLjU7CgkJcHRtcCA9IHB0bXAgKiBmcmVxICogbWF0MngyZihjYSwgLXNhLCBzYSwgY2EpIC0gcmVzICogMC40OwoJfQoKCXJldHVybiByZXM7Cn0KCi8vIFNoYXBlcwovLyBTcGhlcmUKLy8gciA9IHJhZGl1cwpmbiBzaFNwaGVyZShwOiB2ZWMzZiwgcjogZjMyKSAtPiBmMzIgewoJcmV0dXJuIGxlbmd0aChwKSAtIHI7Cn0KCi8vIFRyaWFuZ3VsYXIgcHJpc20KZm4gc2hUcmlhbmd1bGFyUHJpc20ocDogdmVjM2YsIGg6IHZlYzJmKSAtPiBmMzIgewoJbGV0IHE6IHZlYzNmID0gYWJzKHApOwoKCXJldHVybiBtYXgocS56IC0gaC55LCBtYXgocS54ICogMC44NjYwMjUgKyBwLnkgKiAwLjUsIC1wLnkpIC0gaC54ICogMC41KTsKfQoKLy8gT3BlcmF0aW9ucwpmbiBvcFNtb290aFVuaW9uKGE6IE9iamVjdCwgYjogT2JqZWN0LCBrOiBmMzIpIC0+IE9iamVjdCB7CglsZXQgaDogZjMyID0gbWF4KGsgLSBhYnMoYS5kaXN0IC0gYi5kaXN0KSwgMC4wKTsKCWxldCBuZXdEaXN0OiBmMzIgPSBtaW4oYS5kaXN0LCBiLmRpc3QpIC0gaCAqIGggKiAwLjI1IC8gazsKCglsZXQgYmY6IGYzMiA9IChoIC8gaykgKiAoaCAvIGspICogMC41OwoJdmFyIGJsZW5kRmFjdG9yOiBmMzI7CglpZiAoYS5kaXN0IDwgYi5kaXN0KSB7CgkJYmxlbmRGYWN0b3IgPSBiZjsKCX0KCWVsc2UgewoJCWJsZW5kRmFjdG9yID0gKDEuMCAtIGJmKTsKCX0KCglsZXQgbmV3TWF0OiBNYXRlcmlhbCA9IE1hdGVyaWFsKG1peChhLm1hdC5kaWZmdXNlLCBiLm1hdC5kaWZmdXNlLCBibGVuZEZhY3RvciksIG1peChhLm1hdC5tZXRhbGxpY1JvdWdobmVzcywgYi5tYXQubWV0YWxsaWNSb3VnaG5lc3MsIGJsZW5kRmFjdG9yKSk7CgoJcmV0dXJuIE9iamVjdChuZXdEaXN0LCBuZXdNYXQpOwp9CgpmbiBvcFNtb290aEludGVyc2VjdGlvbihhOiBPYmplY3QsIGI6IE9iamVjdCwgazogZjMyKSAtPiBPYmplY3QgewoJdmFyIG9iamVjdDogT2JqZWN0ID0gb3BTbW9vdGhVbmlvbihPYmplY3QoLWEuZGlzdCwgYS5tYXQpLCBPYmplY3QoLWIuZGlzdCwgYi5tYXQpLCBrKTsKCW9iamVjdC5kaXN0ICo9IC0xLjA7CgoJcmV0dXJuIG9iamVjdDsKfQoKZm4gb3BTbW9vdGhEaWZmZXJlbmNlKGE6IE9iamVjdCwgYjogT2JqZWN0LCBrOiBmMzIpIC0+IE9iamVjdCB7Cgl2YXIgb2JqZWN0OiBPYmplY3QgPSBvcFNtb290aFVuaW9uKGIsIE9iamVjdCgtYS5kaXN0LCBhLm1hdCksIGspOwoJb2JqZWN0LmRpc3QgKj0gLTEuMDsKCglyZXR1cm4gb2JqZWN0Owp9CgovLyBUcmFuc2Zvcm0KZm4gcm90YXRlKHA6IHZlYzJmLCBhbmdsZTogZjMyKSAtPiB2ZWMyZiB7CglyZXR1cm4gY29zKGFuZ2xlKSAqIHAgKyBzaW4oYW5nbGUpICogdmVjMmYocC55LCAtcC54KTsKfQoKLy8gUmF5IEluZmluaXRlIFJlcGVhdAovLyBwID0gcmF5IHBvc2l0aW9uCi8vIG4gPSBwZXJpb2Qgb24gZWFjaCBheGlzCmZuIHJheVJlcGVhdChwOiB2ZWMzZiwgbjogdmVjM2YpIC0+IHZlYzNmIHsKCXJldHVybiB2ZWMzZihnbHNsbW9kKHAueCwgbi54KSwgZ2xzbG1vZChwLnksIG4ueSksIGdsc2xtb2QocC56LCBuLnopKSAtIChuIC8gMi4wKTsKfQoKZm4gZGlzcGxhY2UocDogdmVjM2YpIC0+IGYzMiB7CglyZXR1cm4gc2luKHAueCArIDQuMCAqIHRpbWUpICogc2luKHAueSArIHNpbigyLjAgKiB0aW1lKSkgKiBzaW4ocC56ICsgNi4wICogdGltZSk7Cn0KCi8vIFNjZW5lCmZuIHNjZW5lKHA6IHZlYzNmKSAtPiBPYmplY3QgewoJbGV0IG51dHNoZWxsV29ybGRQb3NpdGlvbjogdmVjM2YgPSB2ZWMzZigwLjAsIDAuMCwgMTUuMCk7CgoJbGV0IHBOdXRzaGVsbEhvbGU6IHZlYzNmID0gdmVjM2Yocm90YXRlKHAueHksIDEuNSksIHAueik7Cgl2YXIgcDI6IHZlYzNmID0gdmVjM2YocC54LCByb3RhdGUocC55eiwgc2luKHRpbWUgKiAwLjUpKSk7CglwMiA9IHJheVJlcGVhdChwLCB2ZWMzZig1LjApKTsKCglsZXQgc3BoZXJlOiBPYmplY3QgPSBPYmplY3Qoc2hTcGhlcmUocCAtIG51dHNoZWxsV29ybGRQb3NpdGlvbiwgNS4wICsgZGlzcGxhY2UocDIpKSwgTWF0ZXJpYWwodmVjM2YoMS4wLCAxLjAsIDEuMCksIHZlYzJmKDAuNSAsIDEuMCkpKTsKCWxldCBudXRzaGVsbEhvbGU6IE9iamVjdCA9IE9iamVjdChzaFRyaWFuZ3VsYXJQcmlzbShwTnV0c2hlbGxIb2xlIC0gdmVjM2YoLTEuMCwgLTMuNSwgMC4wKSAtIG51dHNoZWxsV29ybGRQb3NpdGlvbiwgdmVjMmYoNy4wLCA1LjApKSwgTWF0ZXJpYWwodmVjM2YoMC4wLCAwLjAsIDAuMCksIHZlYzJmKDAuMCwgMC41KSkpOwoKCWxldCBzY2VuZTogT2JqZWN0ID0gb3BTbW9vdGhEaWZmZXJlbmNlKHNwaGVyZSwgbnV0c2hlbGxIb2xlLCAyLjApOwoKCXJldHVybiBzY2VuZTsKfQoKLy8gQmFja2dyb3VuZApmbiBiYWNrZ3JvdW5kKHA6IHZlYzNmKSAtPiB2ZWMzZiB7CglyZXR1cm4gdmVjM2YoZmJtKHAuengpLCBmYm0ocC55eCksIGZibShwLnh5KSk7Cn0KCi8vIENhbWVyYQpjb25zdCB1cDogdmVjM2YgPSB2ZWMzZigwLjAsIDEuMCwgMC4wKTsKCmZuIGNhbWVyYSgpIC0+IG1hdDN4M2YgewoJbGV0IGZvcndhcmQ6IHZlYzNmID0gbm9ybWFsaXplKGNhbWVyYURpcmVjdGlvbik7CglsZXQgcmlnaHQ6IHZlYzNmID0gbm9ybWFsaXplKGNyb3NzKHVwLCBmb3J3YXJkKSk7CglsZXQgcmVhbFVwOiB2ZWMzZiA9IGNyb3NzKGZvcndhcmQsIHJpZ2h0KTsKCglyZXR1cm4gbWF0M3gzZihyaWdodCwgcmVhbFVwLCBmb3J3YXJkKTsKfQoKLy8gTGlnaHRzCmNvbnN0IExJR0hUU19DT1VOVDogdTMyID0gMnU7CmZuIGxpZ2h0cygpIC0+IGFycmF5PExpZ2h0LCBMSUdIVFNfQ09VTlQ+IHsKCXZhciBsOiBhcnJheTxMaWdodCwgTElHSFRTX0NPVU5UPjsKCWxbMF0gPSBMaWdodCgwdSwgdmVjM2YoMC4wKSwgdmVjM2YoMS4wLCAtMS4wLCAwLjApLCB2ZWMzZigxLjAsIDEuMCwgMS4wKSwgdmVjMmYoMC4wKSk7CglsWzFdID0gTGlnaHQoMXUsIHZlYzNmKDEuMCwgMS4wLCAwLjApLCB2ZWMzZigwLjApLCB2ZWMzZigxLjAsIDAuMCwgMC4wKSwgdmVjMmYoMC4wKSk7CgkKCXJldHVybiBsOwp9CgpmbiByYXltYXJjaChvOiB2ZWMzZiwgZDogdmVjM2YpIC0+IE9iamVjdCB7Cgl2YXIgb2JqZWN0OiBPYmplY3QgPSBPYmplY3QoMC4wLCBNYXRlcmlhbCh2ZWMzZigwLjApLCB2ZWMyZigwLjApKSk7Cglmb3IgKHZhciBpOiB1MzIgPSAwdTsgaSA8IE1BWF9TVEVQUzsgaSsrKSB7CgkJbGV0IHA6IHZlYzNmID0gbyArIG9iamVjdC5kaXN0ICogZDsKCQlsZXQgb2JqZWN0SGl0OiBPYmplY3QgPSBzY2VuZShwKTsKCQlpZiAoYWJzKG9iamVjdEhpdC5kaXN0KSA8IEVQU0lMT04pIHsKCQkJYnJlYWs7CgkJfQoJCW9iamVjdC5kaXN0ICs9IG9iamVjdEhpdC5kaXN0OwoJCW9iamVjdC5tYXQgPSBvYmplY3RIaXQubWF0OwoJCWlmIChvYmplY3QuZGlzdCA+IE1BWF9ESVNUQU5DRSkgewoJCQlicmVhazsKCQl9Cgl9CgoJcmV0dXJuIG9iamVjdDsKfQoKLy8gQ29tcHV0ZSBub3JtYWwKZm4gbm9ybWFsKHA6IHZlYzNmKSAtPiB2ZWMzZiB7CglsZXQgZTogdmVjMmYgPSB2ZWMyZihFUFNJTE9OLCAwLjApOwoJbGV0IG46IHZlYzNmID0gdmVjM2Yoc2NlbmUocCkuZGlzdCkgLSB2ZWMzZihzY2VuZShwIC0gZS54eXkpLmRpc3QsIHNjZW5lKHAgLSBlLnl4eSkuZGlzdCwgc2NlbmUocCAtIGUueXl4KS5kaXN0KTsKCglyZXR1cm4gbm9ybWFsaXplKG4pOwp9CgovLyBCUkRGCmZuIGRpc3RyaWJ1dGlvbihOZG90SDogZjMyLCByb3VnaG5lc3M6IGYzMikgLT4gZjMyIHsKCWxldCBhOiBmMzIgPSByb3VnaG5lc3MgKiByb3VnaG5lc3M7CglsZXQgYVNxdWFyZTogZjMyID0gYSAqIGE7CglsZXQgTmRvdEhTcXVhcmU6IGYzMiA9IE5kb3RIICogTmRvdEg7CglsZXQgZGVub206IGYzMiA9IE5kb3RIU3F1YXJlICogKGFTcXVhcmUgLSAxLjApICsgMS4wOwoKCXJldHVybiBhU3F1YXJlIC8gKE1fUEkgKiBkZW5vbSAqIGRlbm9tKTsKfQoKZm4gZnJlc25lbChjb3NUaGV0YTogZjMyLCBmMDogdmVjM2YpIC0+IHZlYzNmIHsKCXJldHVybiBmMCArICgxLjAgLSBmMCkgKiBwb3coMS4wIC0gY29zVGhldGEsIDUuMCk7Cn0KCmZuIGcoTmRvdFY6IGYzMiwgcm91Z2huZXNzOiBmMzIpIC0+IGYzMiB7CglsZXQgcjogZjMyID0gcm91Z2huZXNzICsgMS4wOwoJbGV0IGs6IGYzMiA9IChyICogcikgLyA4LjA7CglsZXQgZGVub206IGYzMiA9IE5kb3RWICogKDEuMCAtIGspICsgazsKCglyZXR1cm4gTmRvdFYgLyBkZW5vbTsKfQoKZm4gc21pdGgoTGRvdE46IGYzMiwgVmRvdE46IGYzMiwgcm91Z2huZXNzOiBmMzIpIC0+IGYzMiB7CglsZXQgZ3Y6IGYzMiA9IGcoVmRvdE4sIHJvdWdobmVzcyk7CglsZXQgZ2w6IGYzMiA9IGcoTGRvdE4sIHJvdWdobmVzcyk7CgoJcmV0dXJuIGd2ICogZ2w7Cn0KCmZuIGRpZmZ1c2VGcmVzbmVsQ29ycmVjdGlvbihpb3I6IHZlYzNmKSAtPiB2ZWMzZiB7CglsZXQgaW9yU3F1YXJlOiB2ZWMzZiA9IGlvciAqIGlvcjsKCXZhciBUSVI6IHZlYzNmOwoJaWYgKGlvci54IDwgMS4wKSB7CgkJVElSLnggPSAxLjA7Cgl9CgllbHNlIHsKCQlUSVIueCA9IDAuMDsKCX0KCWlmIChpb3IueSA8IDEuMCkgewoJCVRJUi55ID0gMS4wOwoJfQoJZWxzZSB7CgkJVElSLnkgPSAwLjA7Cgl9CglpZiAoaW9yLnogPCAxLjApIHsKCQlUSVIueiA9IDEuMDsKCX0KCWVsc2UgewoJCVRJUi56ID0gMC4wOwoJfQoJbGV0IGludkRlbnVtOiB2ZWMzZiA9IG1peCh2ZWMzZigxLjApLCB2ZWMzZigxLjApIC8gKGlvclNxdWFyZSAqIGlvclNxdWFyZSAqICh2ZWMzZig1NTQuMzMpICogMzgwLjcgKiBpb3IpKSwgVElSKTsKCXZhciBudW06IHZlYzNmID0gaW9yICogbWl4KHZlYzNmKDAuMTkyMTE1NjEwMjI1MTA4OCksIGlvciAqIDI5OC4yNSAtIDI2MS4zOCAqIGlvclNxdWFyZSArIDEzOC40MywgVElSKTsKCW51bSArPSBtaXgodmVjM2YoMC44MDc4ODQzODk3NzQ4OTEyKSwgdmVjM2YoLTEuMDcpLCBUSVIpOwoKCXJldHVybiBudW0gKiBpbnZEZW51bTsKfQoKZm4gYnJkZihMZG90SDogZjMyLCBOZG90SDogZjMyLCBWZG90SDogZjMyLCBMZG90TjogZjMyLCBWZG90TjogZjMyLCBkaWZmdXNlOiB2ZWMzZiwgbWV0YWxsaWM6IGYzMiwgcm91Z2huZXNzOiBmMzIpIC0+IHZlYzNmIHsKCWxldCBkOiBmMzIgPSBkaXN0cmlidXRpb24oTmRvdEgsIHJvdWdobmVzcyk7CglsZXQgZjogdmVjM2YgPSBmcmVzbmVsKExkb3RILCBtaXgodmVjM2YoMC4wNCksIGRpZmZ1c2UsIG1ldGFsbGljKSk7CglsZXQgZlQ6IHZlYzNmID0gZnJlc25lbChMZG90TiwgbWl4KHZlYzNmKDAuMDQpLCBkaWZmdXNlLCBtZXRhbGxpYykpOwoJbGV0IGZUSVI6IHZlYzNmID0gZnJlc25lbChWZG90TiwgbWl4KHZlYzNmKDAuMDQpLCBkaWZmdXNlLCBtZXRhbGxpYykpOwoJbGV0IGc6IGYzMiA9IHNtaXRoKExkb3ROLCBWZG90Tiwgcm91Z2huZXNzKTsKCWxldCBkZmM6IHZlYzNmID0gZGlmZnVzZUZyZXNuZWxDb3JyZWN0aW9uKHZlYzNmKDEuMDUpKTsKCglsZXQgbGFtYmVydGlhbjogdmVjM2YgPSBkaWZmdXNlIC8gTV9QSTsKCglyZXR1cm4gKGQgKiBmICogZykgLyBtYXgoNC4wICogTGRvdE4gKiBWZG90TiwgMC4wMDEpICsgKCh2ZWMzZigxLjApIC0gZlQpICogKHZlYzNmKDEuMCAtIGZUSVIpKSAqIGxhbWJlcnRpYW4pICogZGZjOwp9CgpmbiBzaGFkZShwOiB2ZWMzZiwgZDogdmVjM2YsIG46IHZlYzNmLCBsaWdodFBvczogdmVjM2YsIGxpZ2h0Q29sb3I6IHZlYzNmLCBkaWZmdXNlOiB2ZWMzZiwgbWV0YWxsaWM6IGYzMiwgcm91Z2huZXNzOiBmMzIpIC0+IHZlYzNmIHsKCWxldCBsOiB2ZWMzZiA9IG5vcm1hbGl6ZShsaWdodFBvcyAtIHApOwoJbGV0IHY6IHZlYzNmID0gLWQ7CglsZXQgaDogdmVjM2YgPSBub3JtYWxpemUodiArIGwpOwoKCWxldCBMZG90SDogZjMyID0gbWF4KGRvdChsLCBoKSwgMC4wKTsKCWxldCBOZG90SDogZjMyID0gbWF4KGRvdChuLCBoKSwgMC4wKTsKCWxldCBWZG90SDogZjMyID0gbWF4KGRvdCh2LCBoKSwgMC4wKTsKCWxldCBMZG90TjogZjMyID0gbWF4KGRvdChsLCBuKSwgMC4wKTsKCWxldCBWZG90TjogZjMyID0gbWF4KGRvdCh2LCBuKSwgMC4wKTsKCglsZXQgYnJkZjogdmVjM2YgPSBicmRmKExkb3RILCBOZG90SCwgVmRvdEgsIExkb3ROLCBWZG90TiwgZGlmZnVzZSwgbWV0YWxsaWMsIHJvdWdobmVzcyk7CgkKCXJldHVybiBsaWdodENvbG9yICogYnJkZiAqIExkb3ROOwp9CgovLyBTaGFkb3dzCmZuIHNoYWRvd3MocDogdmVjM2YsIG46IHZlYzNmLCBsaWdodFBvczogdmVjM2YpIC0+IGYzMiB7Cgl2YXIgcmVzOiBmMzIgPSAxLjA7Cgl2YXIgZGlzdDogZjMyID0gMC4wMTsKCWxldCBsaWdodFNpemU6IGYzMiA9IDAuMTU7Cglmb3IgKHZhciBpOiB1MzIgPSAwdTsgaSA8IE1BWF9TVEVQUzsgaSsrKSB7CgkJbGV0IGhpdDogZjMyID0gc2NlbmUocCArIGxpZ2h0UG9zICogZGlzdCkuZGlzdDsKCQlyZXMgPSBtaW4ocmVzLCBoaXQgLyAoZGlzdCAqIGxpZ2h0U2l6ZSkpOwoJCWRpc3QgKz0gaGl0OwoJCWlmIChoaXQgPCBFUFNJTE9OIHx8IGRpc3QgPiA2MC4wKSB7CgkJCWJyZWFrOwoJCX0KCX0KCglyZXR1cm4gY2xhbXAocmVzLCAwLjAsIDEuMCk7Cn0KCi8vIEFtYmllbnQgT2NjbHVzaW9uCmZuIGFtYmllbnRPY2NsdXNpb24ocDogdmVjM2YsIG46IHZlYzNmKSAtPiBmMzIgewoJdmFyIGFvOiBmMzIgPSAwLjA7Cgl2YXIgd2VpZ2h0OiBmMzIgPSAxLjA7Cglmb3IgKHZhciBpOiB1MzIgPSAwdTsgaSA8IDh1OyBpKyspIHsKCQlsZXQgbGVuOiBmMzIgPSAwLjAxICsgMC4wMiAqIGYzMihpICogaSk7CgkJbGV0IGRpc3Q6IGYzMiA9IHNjZW5lKHAgKyBuICogbGVuKS5kaXN0OwoJCWFvICs9IChsZW4gLSBkaXN0KSAqIHdlaWdodDsKCQl3ZWlnaHQgKj0gMC44NTsKCX0KCglyZXR1cm4gMS4wIC0gY2xhbXAoMC42ICogYW8sIDAuMCwgMS4wKTsKfQoKLy8gUmVuZGVyCmZuIHJlbmRlcihvOiB2ZWMzZiwgZDogdmVjM2YpIC0+IHZlYzNmIHsKCXZhciB0bXBvOiB2ZWMzZiA9IG87Cgl2YXIgdG1wZDogdmVjM2YgPSBkOwoKCXZhciBsaWdodHNMaXN0OiBhcnJheTxMaWdodCwgTElHSFRTX0NPVU5UPiA9IGxpZ2h0cygpOwoKCWxldCBmb2dEZW5zaXR5OiBmMzIgPSAwLjAwMDg7CgoJdmFyIGZyYWM6IGYzMiA9IDEuMDsKCXZhciBjb2xvcjogdmVjM2YgPSB2ZWMzZigwLjAsIDAuMCwgMC4wKTsKCWZvciAodmFyIGRlcHRoOiB1MzIgPSAwdTsgZGVwdGggPCBNQVhfQk9VTkNFUyArIDF1OyBkZXB0aCsrKSB7CgkJdmFyIGxvY2FsQ29sb3I6IHZlYzNmID0gdmVjM2YoMC4wLCAwLjAsIDAuMCk7CgoJCS8vIFJheW1hcmNoCgkJbGV0IG9iamVjdDogT2JqZWN0ID0gcmF5bWFyY2godG1wbywgdG1wZCk7CgkJbGV0IHA6IHZlYzNmID0gdG1wbyArIG9iamVjdC5kaXN0ICogdG1wZDsKCQkKCQlsZXQgbjogdmVjM2YgPSBub3JtYWwocCk7CgkJbGV0IG1ldGFsbGljOiBmMzIgPSBvYmplY3QubWF0Lm1ldGFsbGljUm91Z2huZXNzLng7CgkJaWYgKG9iamVjdC5kaXN0IDw9IE1BWF9ESVNUQU5DRSkgewoJCQkvLyBPYmplY3QgcHJvcGVydGllcwoJCQlsZXQgZGlmZnVzZTogdmVjM2YgPSBvYmplY3QubWF0LmRpZmZ1c2U7CgkJCWxldCByb3VnaG5lc3M6IGYzMiA9IG9iamVjdC5tYXQubWV0YWxsaWNSb3VnaG5lc3MueTsKCQkJbGV0IGFvOiBmMzIgPSBhbWJpZW50T2NjbHVzaW9uKHAsIG4pOwoKCQkJLy8gTG9jYWwgY29sb3IKCQkJZm9yICh2YXIgbGlnaHRJbmRleDogdTMyID0gMHU7IGxpZ2h0SW5kZXggPCBMSUdIVFNfQ09VTlQ7IGxpZ2h0SW5kZXgrKykgewoJCQkJLy8gRGlyZWN0aW9uYWwgTGlnaHQKCQkJCWlmIChsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmxpZ2h0VHlwZSA9PSAwdSkgewoJCQkJCWxldCBsOiB2ZWMzZiA9IG5vcm1hbGl6ZSgtbGlnaHRzTGlzdFtsaWdodEluZGV4XS5kaXJlY3Rpb24pOwoJCQkJCWxldCBsYzogdmVjM2YgPSBsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmNvbG9yOwoJCQkJCWxvY2FsQ29sb3IgKz0gc2hhZGUocCwgdG1wZCwgbiwgbCwgbGMsIGRpZmZ1c2UsIG1ldGFsbGljLCByb3VnaG5lc3MpICogc2hhZG93cyhwLCBuLCBsKTsKCQkJCX0KCQkJCS8vIFBvaW50IExpZ2h0CgkJCQllbHNlIGlmIChsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmxpZ2h0VHlwZSA9PSAxdSkgewoJCQkJCWxldCBsOiB2ZWMzZiA9IG5vcm1hbGl6ZShsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLnBvc2l0aW9uIC0gcCk7CgkJCQkJbGV0IGRpc3RhbmNlOiBmMzIgPSBsZW5ndGgobGlnaHRzTGlzdFtsaWdodEluZGV4XS5wb3NpdGlvbiAtIHApOwoJCQkJCWxldCBhdHRlbnVhdGlvbjogZjMyID0gMS4wIC8gKGRpc3RhbmNlICogZGlzdGFuY2UpOwoJCQkJCWxldCBsYzogdmVjM2YgPSBsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmNvbG9yICogYXR0ZW51YXRpb247CgkJCQkJbG9jYWxDb2xvciArPSBzaGFkZShwLCB0bXBkLCBuLCBsLCBsYywgZGlmZnVzZSwgbWV0YWxsaWMsIHJvdWdobmVzcykgKiBzaGFkb3dzKHAsIG4sIGwpOwoJCQkJfQoJCQkJLy8gU3BvdCBMaWdodAoJCQkJZWxzZSBpZiAobGlnaHRzTGlzdFtsaWdodEluZGV4XS5saWdodFR5cGUgPT0gMnUpIHsKCQkJCQlsZXQgbDogdmVjM2YgPSBub3JtYWxpemUobGlnaHRzTGlzdFtsaWdodEluZGV4XS5wb3NpdGlvbiAtIHApOwoJCQkJCWxldCBsZDogdmVjM2YgPSBsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmRpcmVjdGlvbjsKCQkJCQlsZXQgdGhldGE6IGYzMiA9IGRvdChsLCBub3JtYWxpemUoLWxkKSk7CgkJCQkJbGV0IGVwc2lsb246IGYzMiA9IGNvcyhsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmN1dG9mZnMueSAtIGxpZ2h0c0xpc3RbbGlnaHRJbmRleF0uY3V0b2Zmcy54KTsKCQkJCQlsZXQgaW50ZW5zaXR5OiBmMzIgPSBjbGFtcCgodGhldGEgLSBjb3MobGlnaHRzTGlzdFtsaWdodEluZGV4XS5jdXRvZmZzLngpKSAvIGVwc2lsb24sIDAuMCwgMS4wKTsKCQkJCQlsZXQgbGM6IHZlYzNmID0gbGlnaHRzTGlzdFtsaWdodEluZGV4XS5jb2xvcjsKCQkJCQlsb2NhbENvbG9yICs9IHNoYWRlKHAsIHRtcGQsIG4sIGwsIGxjICogaW50ZW5zaXR5LCBkaWZmdXNlICogaW50ZW5zaXR5LCBtZXRhbGxpYywgcm91Z2huZXNzKSAqIHNoYWRvd3MocCwgbiwgbCk7CgkJCQl9CgkJCX0KCQkJbG9jYWxDb2xvciAqPSBhbzsKCQkJbG9jYWxDb2xvciA9IG1peChsb2NhbENvbG9yLCBiYWNrZ3JvdW5kKHApLCAxLjAgLSBleHAoLWZvZ0RlbnNpdHkgKiBvYmplY3QuZGlzdCAqIG9iamVjdC5kaXN0KSk7CgkJfQoJCWVsc2UgewoJCQljb2xvciArPSBiYWNrZ3JvdW5kKHApICogZnJhYzsKCQkJcmV0dXJuIGNvbG9yOwoJCX0KCgkJY29sb3IgKz0gbG9jYWxDb2xvciAqIGZyYWM7CgkJZnJhYyAqPSBtZXRhbGxpYzsKCgkJLy8gRWFybHkgc3RvcCBhcyB0aGUgaW1wYWN0IG9uIHRoZSBmaW5hbCBjb2xvciB3aWxsIG5vdCBiZSBjb25zZXF1ZW50CgkJaWYgKGZyYWMgPCAwLjA1KSB7CgkJCWJyZWFrOwoJCX0KCgkJdG1wbyA9IHAgKyAobiAqIEVQU0lMT04pOwoJCXRtcGQgPSByZWZsZWN0KHRtcGQsIG4pOwoJfQoKCXJldHVybiBjb2xvcjsKfQoKQGZyYWdtZW50CmZuIG1haW4oQGxvY2F0aW9uKDApIHV2OiB2ZWMyZikgLT4gQGxvY2F0aW9uKDApIHZlYzRmIHsKCWxldCBjYW1lcmFNYXRyaXg6IG1hdDN4M2YgPSBjYW1lcmEoKTsKCglsZXQgZGltOiB2ZWMyZiA9IHZlYzJmKGYzMihyZXNvbHV0aW9uLngpLCBmMzIocmVzb2x1dGlvbi55KSk7CglsZXQgbmV3VXY6IHZlYzJmID0gKDIuMCAqICh1diAqIGRpbSkgLSBkaW0pIC8gZGltLnk7CglsZXQgZDogdmVjM2YgPSBjYW1lcmFNYXRyaXggKiBub3JtYWxpemUodmVjM2YobmV3VXYsIDIuMCkpOwoKCWxldCBjb2xvcjogdmVjM2YgPSByZW5kZXIoY2FtZXJhUG9zaXRpb24sIGQpOwoKCXJldHVybiB2ZWM0Zihjb2xvciwgMS4wKTsKfQ==)
- [Metaballs](https://www.team-nutshell.dev/shader/editor.html#Y29uc3QgTV9QSTogZjMyID0gMy4xNDE1OTI2NTM1ODk3OTMyMzg0NjI2NDMzODMyNzk1OwoKY29uc3QgTUFYX1NURVBTOiB1MzIgPSAyNTZ1Owpjb25zdCBNQVhfRElTVEFOQ0U6IGYzMiA9IDEwMDAuMDsKY29uc3QgRVBTSUxPTjogZjMyID0gMC4wMDAxOwpjb25zdCBNQVhfQk9VTkNFUzogdTMyID0gMXU7CgpzdHJ1Y3QgTWF0ZXJpYWwgewoJZGlmZnVzZTogdmVjM2YsCgltZXRhbGxpY1JvdWdobmVzczogdmVjMmYKfQoKc3RydWN0IE9iamVjdCB7CglkaXN0OiBmMzIsCgltYXQ6IE1hdGVyaWFsCn0KCnN0cnVjdCBMaWdodCB7CglsaWdodFR5cGU6IHUzMiwgLy8gMCA9IERpcmVjdGlvbmFsLCAxID0gUG9pbnQsIDIgPSBTcG90Cglwb3NpdGlvbjogdmVjM2YsCglkaXJlY3Rpb246IHZlYzNmLAoJY29sb3I6IHZlYzNmLAoJY3V0b2ZmczogdmVjMmYKfQoKLy8gU2hhcGVzCi8vIFNwaGVyZQovLyByID0gcmFkaXVzCmZuIHNoU3BoZXJlKHA6IHZlYzNmLCByOiBmMzIpIC0+IGYzMiB7CglyZXR1cm4gbGVuZ3RoKHApIC0gcjsKfQoKZm4gb3BTbW9vdGhVbmlvbihhOiBPYmplY3QsIGI6IE9iamVjdCwgazogZjMyKSAtPiBPYmplY3QgewoJbGV0IGg6IGYzMiA9IG1heChrIC0gYWJzKGEuZGlzdCAtIGIuZGlzdCksIDAuMCk7CglsZXQgbmV3RGlzdDogZjMyID0gbWluKGEuZGlzdCwgYi5kaXN0KSAtIGggKiBoICogMC4yNSAvIGs7CgoJbGV0IGJmOiBmMzIgPSAoaCAvIGspICogKGggLyBrKSAqIDAuNTsKCXZhciBibGVuZEZhY3RvcjogZjMyOwoJaWYgKGEuZGlzdCA8IGIuZGlzdCkgewoJCWJsZW5kRmFjdG9yID0gYmY7Cgl9CgllbHNlIHsKCQlibGVuZEZhY3RvciA9ICgxLjAgLSBiZik7Cgl9CgoJbGV0IG5ld01hdDogTWF0ZXJpYWwgPSBNYXRlcmlhbChtaXgoYS5tYXQuZGlmZnVzZSwgYi5tYXQuZGlmZnVzZSwgYmxlbmRGYWN0b3IpLCBtaXgoYS5tYXQubWV0YWxsaWNSb3VnaG5lc3MsIGIubWF0Lm1ldGFsbGljUm91Z2huZXNzLCBibGVuZEZhY3RvcikpOwoKCXJldHVybiBPYmplY3QobmV3RGlzdCwgbmV3TWF0KTsKfQoKLy8gU2NlbmUKZm4gc2NlbmUocDogdmVjM2YpIC0+IE9iamVjdCB7CglsZXQgbWV0YWxsaWNSb3VnaG5lc3M6IHZlYzJmID0gdmVjMihjbGFtcChmMzIobW91c2UueCkgLyBmMzIocmVzb2x1dGlvbi54KSwgMC4wLCAxLjApLCBjbGFtcChmMzIobW91c2UueSkgLyBmMzIocmVzb2x1dGlvbi55KSwgMC4wLCAxLjApKTsKCglsZXQgc3BoZXJlUmVkOiBPYmplY3QgPSBPYmplY3Qoc2hTcGhlcmUocCAtIHZlYzMoY29zKHRpbWUpLCAwLjAsIDMuMCksIDAuMjUpLCBNYXRlcmlhbCh2ZWMzKDEuMCwgMC4wLCAwLjApLCBtZXRhbGxpY1JvdWdobmVzcykpOwoJbGV0IHNwaGVyZUdyZWVuOiBPYmplY3QgPSBPYmplY3Qoc2hTcGhlcmUocCAtIHZlYzMoLWNvcyh0aW1lKSwgMC4wLCAzLjApLCAwLjI1KSwgTWF0ZXJpYWwodmVjMygwLjAsIDEuMCwgMC4wKSwgbWV0YWxsaWNSb3VnaG5lc3MpKTsKCWxldCBzcGhlcmVCbHVlOiBPYmplY3QgPSBPYmplY3Qoc2hTcGhlcmUocCAtIHZlYzMoMC4wLCBjb3ModGltZSksIDMuMCksIDAuMjUpLCBNYXRlcmlhbCh2ZWMzKDAuMCwgMC4wLCAxLjApLCBtZXRhbGxpY1JvdWdobmVzcykpOwoJbGV0IHNwaGVyZVB1cnBsZTogT2JqZWN0ID0gT2JqZWN0KHNoU3BoZXJlKHAgLSB2ZWMzKDAuMCwgLWNvcyh0aW1lKSwgMy4wKSwgMC4yNSksIE1hdGVyaWFsKHZlYzMoMS4wLCAwLjAsIDEuMCksIG1ldGFsbGljUm91Z2huZXNzKSk7CglsZXQgc3BoZXJlWWVsbG93OiBPYmplY3QgPSBPYmplY3Qoc2hTcGhlcmUocCAtIHZlYzMoY29zKHRpbWUpLCAtY29zKHRpbWUpLCAzLjApLCAwLjI1KSwgTWF0ZXJpYWwodmVjMygxLjAsIDEuMCwgMC4wKSwgbWV0YWxsaWNSb3VnaG5lc3MpKTsKCWxldCBzcGhlcmVDeWFuOiBPYmplY3QgPSBPYmplY3Qoc2hTcGhlcmUocCAtIHZlYzMoLWNvcyh0aW1lKSwgLWNvcyh0aW1lKSwgMy4wKSwgMC4yNSksIE1hdGVyaWFsKHZlYzMoMC4wLCAxLjAsIDEuMCksIG1ldGFsbGljUm91Z2huZXNzKSk7CglsZXQgc3BoZXJlQmxhY2s6IE9iamVjdCA9IE9iamVjdChzaFNwaGVyZShwIC0gdmVjMygtY29zKHRpbWUpLCBjb3ModGltZSksIDMuMCksIDAuMjUpLCBNYXRlcmlhbCh2ZWMzKDAuMCwgMC4wLCAwLjApLCBtZXRhbGxpY1JvdWdobmVzcykpOwoJbGV0IHNwaGVyZVdoaXRlOiBPYmplY3QgPSBPYmplY3Qoc2hTcGhlcmUocCAtIHZlYzMoY29zKHRpbWUpLCBjb3ModGltZSksIDMuMCksIDAuMjUpLCBNYXRlcmlhbCh2ZWMzKDEuMCwgMS4wLCAxLjApLCBtZXRhbGxpY1JvdWdobmVzcykpOwoKCXZhciBvYmplY3Q6IE9iamVjdCA9IG9wU21vb3RoVW5pb24oc3BoZXJlUmVkLCBzcGhlcmVHcmVlbiwgMC41KTsKCW9iamVjdCA9IG9wU21vb3RoVW5pb24ob2JqZWN0LCBzcGhlcmVCbHVlLCAwLjUpOwoJb2JqZWN0ID0gb3BTbW9vdGhVbmlvbihvYmplY3QsIHNwaGVyZVB1cnBsZSwgMC41KTsKCW9iamVjdCA9IG9wU21vb3RoVW5pb24ob2JqZWN0LCBzcGhlcmVZZWxsb3csIDAuNSk7CglvYmplY3QgPSBvcFNtb290aFVuaW9uKG9iamVjdCwgc3BoZXJlQ3lhbiwgMC41KTsKCW9iamVjdCA9IG9wU21vb3RoVW5pb24ob2JqZWN0LCBzcGhlcmVCbGFjaywgMC41KTsKCW9iamVjdCA9IG9wU21vb3RoVW5pb24ob2JqZWN0LCBzcGhlcmVXaGl0ZSwgMC41KTsKCglyZXR1cm4gb2JqZWN0Owp9CgovLyBCYWNrZ3JvdW5kCmZuIGJhY2tncm91bmQocDogdmVjM2YpIC0+IHZlYzNmIHsKCXJldHVybiB2ZWMzZigwLjA1LCAwLjA1LCAwLjA1KTsKfQoKLy8gQ2FtZXJhCmNvbnN0IHVwOiB2ZWMzZiA9IHZlYzNmKDAuMCwgMS4wLCAwLjApOwoKZm4gY2FtZXJhKCkgLT4gbWF0M3gzZiB7CglsZXQgZm9yd2FyZDogdmVjM2YgPSBub3JtYWxpemUoY2FtZXJhRGlyZWN0aW9uKTsKCWxldCByaWdodDogdmVjM2YgPSBub3JtYWxpemUoY3Jvc3ModXAsIGZvcndhcmQpKTsKCWxldCByZWFsVXA6IHZlYzNmID0gY3Jvc3MoZm9yd2FyZCwgcmlnaHQpOwoKCXJldHVybiBtYXQzeDNmKHJpZ2h0LCByZWFsVXAsIGZvcndhcmQpOwp9CgovLyBMaWdodHMKY29uc3QgTElHSFRTX0NPVU5UOiB1MzIgPSAxdTsKZm4gbGlnaHRzKCkgLT4gYXJyYXk8TGlnaHQsIExJR0hUU19DT1VOVD4gewoJdmFyIGw6IGFycmF5PExpZ2h0LCBMSUdIVFNfQ09VTlQ+OwoJbFswXSA9IExpZ2h0KDB1LCB2ZWMzZigwLjApLCB2ZWMzZigwLjAsIDAuMCwgMS4wKSwgdmVjM2YoMS4wLCAxLjAsIDEuMCksIHZlYzJmKDAuMCkpOwoJCglyZXR1cm4gbDsKfQoKZm4gcmF5bWFyY2gobzogdmVjM2YsIGQ6IHZlYzNmKSAtPiBPYmplY3QgewoJdmFyIG9iamVjdDogT2JqZWN0ID0gT2JqZWN0KDAuMCwgTWF0ZXJpYWwodmVjM2YoMC4wKSwgdmVjMmYoMC4wKSkpOwoJZm9yICh2YXIgaTogdTMyID0gMHU7IGkgPCBNQVhfU1RFUFM7IGkrKykgewoJCWxldCBwOiB2ZWMzZiA9IG8gKyBvYmplY3QuZGlzdCAqIGQ7CgkJbGV0IG9iamVjdEhpdDogT2JqZWN0ID0gc2NlbmUocCk7CgkJaWYgKGFicyhvYmplY3RIaXQuZGlzdCkgPCBFUFNJTE9OKSB7CgkJCWJyZWFrOwoJCX0KCQlvYmplY3QuZGlzdCArPSBvYmplY3RIaXQuZGlzdDsKCQlvYmplY3QubWF0ID0gb2JqZWN0SGl0Lm1hdDsKCQlpZiAob2JqZWN0LmRpc3QgPiBNQVhfRElTVEFOQ0UpIHsKCQkJYnJlYWs7CgkJfQoJfQoKCXJldHVybiBvYmplY3Q7Cn0KCi8vIENvbXB1dGUgbm9ybWFsCmZuIG5vcm1hbChwOiB2ZWMzZikgLT4gdmVjM2YgewoJbGV0IGU6IHZlYzJmID0gdmVjMmYoRVBTSUxPTiwgMC4wKTsKCWxldCBuOiB2ZWMzZiA9IHZlYzNmKHNjZW5lKHApLmRpc3QpIC0gdmVjM2Yoc2NlbmUocCAtIGUueHl5KS5kaXN0LCBzY2VuZShwIC0gZS55eHkpLmRpc3QsIHNjZW5lKHAgLSBlLnl5eCkuZGlzdCk7CgoJcmV0dXJuIG5vcm1hbGl6ZShuKTsKfQoKLy8gQlJERgpmbiBkaXN0cmlidXRpb24oTmRvdEg6IGYzMiwgcm91Z2huZXNzOiBmMzIpIC0+IGYzMiB7CglsZXQgYTogZjMyID0gcm91Z2huZXNzICogcm91Z2huZXNzOwoJbGV0IGFTcXVhcmU6IGYzMiA9IGEgKiBhOwoJbGV0IE5kb3RIU3F1YXJlOiBmMzIgPSBOZG90SCAqIE5kb3RIOwoJbGV0IGRlbm9tOiBmMzIgPSBOZG90SFNxdWFyZSAqIChhU3F1YXJlIC0gMS4wKSArIDEuMDsKCglyZXR1cm4gYVNxdWFyZSAvIChNX1BJICogZGVub20gKiBkZW5vbSk7Cn0KCmZuIGZyZXNuZWwoY29zVGhldGE6IGYzMiwgZjA6IHZlYzNmKSAtPiB2ZWMzZiB7CglyZXR1cm4gZjAgKyAoMS4wIC0gZjApICogcG93KDEuMCAtIGNvc1RoZXRhLCA1LjApOwp9CgpmbiBnKE5kb3RWOiBmMzIsIHJvdWdobmVzczogZjMyKSAtPiBmMzIgewoJbGV0IHI6IGYzMiA9IHJvdWdobmVzcyArIDEuMDsKCWxldCBrOiBmMzIgPSAociAqIHIpIC8gOC4wOwoJbGV0IGRlbm9tOiBmMzIgPSBOZG90ViAqICgxLjAgLSBrKSArIGs7CgoJcmV0dXJuIE5kb3RWIC8gZGVub207Cn0KCmZuIHNtaXRoKExkb3ROOiBmMzIsIFZkb3ROOiBmMzIsIHJvdWdobmVzczogZjMyKSAtPiBmMzIgewoJbGV0IGd2OiBmMzIgPSBnKFZkb3ROLCByb3VnaG5lc3MpOwoJbGV0IGdsOiBmMzIgPSBnKExkb3ROLCByb3VnaG5lc3MpOwoKCXJldHVybiBndiAqIGdsOwp9CgpmbiBkaWZmdXNlRnJlc25lbENvcnJlY3Rpb24oaW9yOiB2ZWMzZikgLT4gdmVjM2YgewoJbGV0IGlvclNxdWFyZTogdmVjM2YgPSBpb3IgKiBpb3I7Cgl2YXIgVElSOiB2ZWMzZjsKCWlmIChpb3IueCA8IDEuMCkgewoJCVRJUi54ID0gMS4wOwoJfQoJZWxzZSB7CgkJVElSLnggPSAwLjA7Cgl9CglpZiAoaW9yLnkgPCAxLjApIHsKCQlUSVIueSA9IDEuMDsKCX0KCWVsc2UgewoJCVRJUi55ID0gMC4wOwoJfQoJaWYgKGlvci56IDwgMS4wKSB7CgkJVElSLnogPSAxLjA7Cgl9CgllbHNlIHsKCQlUSVIueiA9IDAuMDsKCX0KCWxldCBpbnZEZW51bTogdmVjM2YgPSBtaXgodmVjM2YoMS4wKSwgdmVjM2YoMS4wKSAvIChpb3JTcXVhcmUgKiBpb3JTcXVhcmUgKiAodmVjM2YoNTU0LjMzKSAqIDM4MC43ICogaW9yKSksIFRJUik7Cgl2YXIgbnVtOiB2ZWMzZiA9IGlvciAqIG1peCh2ZWMzZigwLjE5MjExNTYxMDIyNTEwODgpLCBpb3IgKiAyOTguMjUgLSAyNjEuMzggKiBpb3JTcXVhcmUgKyAxMzguNDMsIFRJUik7CgludW0gKz0gbWl4KHZlYzNmKDAuODA3ODg0Mzg5Nzc0ODkxMiksIHZlYzNmKC0xLjA3KSwgVElSKTsKCglyZXR1cm4gbnVtICogaW52RGVudW07Cn0KCmZuIGJyZGYoTGRvdEg6IGYzMiwgTmRvdEg6IGYzMiwgVmRvdEg6IGYzMiwgTGRvdE46IGYzMiwgVmRvdE46IGYzMiwgZGlmZnVzZTogdmVjM2YsIG1ldGFsbGljOiBmMzIsIHJvdWdobmVzczogZjMyKSAtPiB2ZWMzZiB7CglsZXQgZDogZjMyID0gZGlzdHJpYnV0aW9uKE5kb3RILCByb3VnaG5lc3MpOwoJbGV0IGY6IHZlYzNmID0gZnJlc25lbChMZG90SCwgbWl4KHZlYzNmKDAuMDQpLCBkaWZmdXNlLCBtZXRhbGxpYykpOwoJbGV0IGZUOiB2ZWMzZiA9IGZyZXNuZWwoTGRvdE4sIG1peCh2ZWMzZigwLjA0KSwgZGlmZnVzZSwgbWV0YWxsaWMpKTsKCWxldCBmVElSOiB2ZWMzZiA9IGZyZXNuZWwoVmRvdE4sIG1peCh2ZWMzZigwLjA0KSwgZGlmZnVzZSwgbWV0YWxsaWMpKTsKCWxldCBnOiBmMzIgPSBzbWl0aChMZG90TiwgVmRvdE4sIHJvdWdobmVzcyk7CglsZXQgZGZjOiB2ZWMzZiA9IGRpZmZ1c2VGcmVzbmVsQ29ycmVjdGlvbih2ZWMzZigxLjA1KSk7CgoJbGV0IGxhbWJlcnRpYW46IHZlYzNmID0gZGlmZnVzZSAvIE1fUEk7CgoJcmV0dXJuIChkICogZiAqIGcpIC8gbWF4KDQuMCAqIExkb3ROICogVmRvdE4sIDAuMDAxKSArICgodmVjM2YoMS4wKSAtIGZUKSAqICh2ZWMzZigxLjAgLSBmVElSKSkgKiBsYW1iZXJ0aWFuKSAqIGRmYzsKfQoKZm4gc2hhZGUocDogdmVjM2YsIGQ6IHZlYzNmLCBuOiB2ZWMzZiwgbGlnaHRQb3M6IHZlYzNmLCBsaWdodENvbG9yOiB2ZWMzZiwgZGlmZnVzZTogdmVjM2YsIG1ldGFsbGljOiBmMzIsIHJvdWdobmVzczogZjMyKSAtPiB2ZWMzZiB7CglsZXQgbDogdmVjM2YgPSBub3JtYWxpemUobGlnaHRQb3MgLSBwKTsKCWxldCB2OiB2ZWMzZiA9IC1kOwoJbGV0IGg6IHZlYzNmID0gbm9ybWFsaXplKHYgKyBsKTsKCglsZXQgTGRvdEg6IGYzMiA9IG1heChkb3QobCwgaCksIDAuMCk7CglsZXQgTmRvdEg6IGYzMiA9IG1heChkb3QobiwgaCksIDAuMCk7CglsZXQgVmRvdEg6IGYzMiA9IG1heChkb3QodiwgaCksIDAuMCk7CglsZXQgTGRvdE46IGYzMiA9IG1heChkb3QobCwgbiksIDAuMCk7CglsZXQgVmRvdE46IGYzMiA9IG1heChkb3QodiwgbiksIDAuMCk7CgoJbGV0IGJyZGY6IHZlYzNmID0gYnJkZihMZG90SCwgTmRvdEgsIFZkb3RILCBMZG90TiwgVmRvdE4sIGRpZmZ1c2UsIG1ldGFsbGljLCByb3VnaG5lc3MpOwoJCglyZXR1cm4gbGlnaHRDb2xvciAqIGJyZGYgKiBMZG90TjsKfQoKLy8gU2hhZG93cwpmbiBzaGFkb3dzKHA6IHZlYzNmLCBuOiB2ZWMzZiwgbGlnaHRQb3M6IHZlYzNmKSAtPiBmMzIgewoJdmFyIHJlczogZjMyID0gMS4wOwoJdmFyIGRpc3Q6IGYzMiA9IDAuMDE7CglsZXQgbGlnaHRTaXplOiBmMzIgPSAwLjE1OwoJZm9yICh2YXIgaTogdTMyID0gMHU7IGkgPCBNQVhfU1RFUFM7IGkrKykgewoJCWxldCBoaXQ6IGYzMiA9IHNjZW5lKHAgKyBsaWdodFBvcyAqIGRpc3QpLmRpc3Q7CgkJcmVzID0gbWluKHJlcywgaGl0IC8gKGRpc3QgKiBsaWdodFNpemUpKTsKCQlkaXN0ICs9IGhpdDsKCQlpZiAoaGl0IDwgRVBTSUxPTiB8fCBkaXN0ID4gNjAuMCkgewoJCQlicmVhazsKCQl9Cgl9CgoJcmV0dXJuIGNsYW1wKHJlcywgMC4wLCAxLjApOwp9CgovLyBBbWJpZW50IE9jY2x1c2lvbgpmbiBhbWJpZW50T2NjbHVzaW9uKHA6IHZlYzNmLCBuOiB2ZWMzZikgLT4gZjMyIHsKCXZhciBhbzogZjMyID0gMC4wOwoJdmFyIHdlaWdodDogZjMyID0gMS4wOwoJZm9yICh2YXIgaTogdTMyID0gMHU7IGkgPCA4dTsgaSsrKSB7CgkJbGV0IGxlbjogZjMyID0gMC4wMSArIDAuMDIgKiBmMzIoaSAqIGkpOwoJCWxldCBkaXN0OiBmMzIgPSBzY2VuZShwICsgbiAqIGxlbikuZGlzdDsKCQlhbyArPSAobGVuIC0gZGlzdCkgKiB3ZWlnaHQ7CgkJd2VpZ2h0ICo9IDAuODU7Cgl9CgoJcmV0dXJuIDEuMCAtIGNsYW1wKDAuNiAqIGFvLCAwLjAsIDEuMCk7Cn0KCi8vIFJlbmRlcgpmbiByZW5kZXIobzogdmVjM2YsIGQ6IHZlYzNmKSAtPiB2ZWMzZiB7Cgl2YXIgdG1wbzogdmVjM2YgPSBvOwoJdmFyIHRtcGQ6IHZlYzNmID0gZDsKCgl2YXIgbGlnaHRzTGlzdDogYXJyYXk8TGlnaHQsIExJR0hUU19DT1VOVD4gPSBsaWdodHMoKTsKCglsZXQgZm9nRGVuc2l0eTogZjMyID0gMC4wMDA4OwoKCXZhciBmcmFjOiBmMzIgPSAxLjA7Cgl2YXIgY29sb3I6IHZlYzNmID0gdmVjM2YoMC4wLCAwLjAsIDAuMCk7Cglmb3IgKHZhciBkZXB0aDogdTMyID0gMHU7IGRlcHRoIDwgTUFYX0JPVU5DRVMgKyAxdTsgZGVwdGgrKykgewoJCXZhciBsb2NhbENvbG9yOiB2ZWMzZiA9IHZlYzNmKDAuMCwgMC4wLCAwLjApOwoKCQkvLyBSYXltYXJjaAoJCWxldCBvYmplY3Q6IE9iamVjdCA9IHJheW1hcmNoKHRtcG8sIHRtcGQpOwoJCWxldCBwOiB2ZWMzZiA9IHRtcG8gKyBvYmplY3QuZGlzdCAqIHRtcGQ7CgkJCgkJbGV0IG46IHZlYzNmID0gbm9ybWFsKHApOwoJCWxldCBtZXRhbGxpYzogZjMyID0gb2JqZWN0Lm1hdC5tZXRhbGxpY1JvdWdobmVzcy54OwoJCWlmIChvYmplY3QuZGlzdCA8PSBNQVhfRElTVEFOQ0UpIHsKCQkJLy8gT2JqZWN0IHByb3BlcnRpZXMKCQkJbGV0IGRpZmZ1c2U6IHZlYzNmID0gb2JqZWN0Lm1hdC5kaWZmdXNlOwoJCQlsZXQgcm91Z2huZXNzOiBmMzIgPSBvYmplY3QubWF0Lm1ldGFsbGljUm91Z2huZXNzLnk7CgkJCWxldCBhbzogZjMyID0gYW1iaWVudE9jY2x1c2lvbihwLCBuKTsKCgkJCS8vIExvY2FsIGNvbG9yCgkJCWZvciAodmFyIGxpZ2h0SW5kZXg6IHUzMiA9IDB1OyBsaWdodEluZGV4IDwgTElHSFRTX0NPVU5UOyBsaWdodEluZGV4KyspIHsKCQkJCS8vIERpcmVjdGlvbmFsIExpZ2h0CgkJCQlpZiAobGlnaHRzTGlzdFtsaWdodEluZGV4XS5saWdodFR5cGUgPT0gMHUpIHsKCQkJCQlsZXQgbDogdmVjM2YgPSBub3JtYWxpemUoLWxpZ2h0c0xpc3RbbGlnaHRJbmRleF0uZGlyZWN0aW9uKTsKCQkJCQlsZXQgbGM6IHZlYzNmID0gbGlnaHRzTGlzdFtsaWdodEluZGV4XS5jb2xvcjsKCQkJCQlsb2NhbENvbG9yICs9IHNoYWRlKHAsIHRtcGQsIG4sIGwsIGxjLCBkaWZmdXNlLCBtZXRhbGxpYywgcm91Z2huZXNzKSAqIHNoYWRvd3MocCwgbiwgbCk7CgkJCQl9CgkJCQkvLyBQb2ludCBMaWdodAoJCQkJZWxzZSBpZiAobGlnaHRzTGlzdFtsaWdodEluZGV4XS5saWdodFR5cGUgPT0gMXUpIHsKCQkJCQlsZXQgbDogdmVjM2YgPSBub3JtYWxpemUobGlnaHRzTGlzdFtsaWdodEluZGV4XS5wb3NpdGlvbiAtIHApOwoJCQkJCWxldCBkaXN0YW5jZTogZjMyID0gbGVuZ3RoKGxpZ2h0c0xpc3RbbGlnaHRJbmRleF0ucG9zaXRpb24gLSBwKTsKCQkJCQlsZXQgYXR0ZW51YXRpb246IGYzMiA9IDEuMCAvIChkaXN0YW5jZSAqIGRpc3RhbmNlKTsKCQkJCQlsZXQgbGM6IHZlYzNmID0gbGlnaHRzTGlzdFtsaWdodEluZGV4XS5jb2xvciAqIGF0dGVudWF0aW9uOwoJCQkJCWxvY2FsQ29sb3IgKz0gc2hhZGUocCwgdG1wZCwgbiwgbCwgbGMsIGRpZmZ1c2UsIG1ldGFsbGljLCByb3VnaG5lc3MpICogc2hhZG93cyhwLCBuLCBsKTsKCQkJCX0KCQkJCS8vIFNwb3QgTGlnaHQKCQkJCWVsc2UgaWYgKGxpZ2h0c0xpc3RbbGlnaHRJbmRleF0ubGlnaHRUeXBlID09IDJ1KSB7CgkJCQkJbGV0IGw6IHZlYzNmID0gbm9ybWFsaXplKGxpZ2h0c0xpc3RbbGlnaHRJbmRleF0ucG9zaXRpb24gLSBwKTsKCQkJCQlsZXQgbGQ6IHZlYzNmID0gbGlnaHRzTGlzdFtsaWdodEluZGV4XS5kaXJlY3Rpb247CgkJCQkJbGV0IHRoZXRhOiBmMzIgPSBkb3QobCwgbm9ybWFsaXplKC1sZCkpOwoJCQkJCWxldCBlcHNpbG9uOiBmMzIgPSBjb3MobGlnaHRzTGlzdFtsaWdodEluZGV4XS5jdXRvZmZzLnkgLSBsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmN1dG9mZnMueCk7CgkJCQkJbGV0IGludGVuc2l0eTogZjMyID0gY2xhbXAoKHRoZXRhIC0gY29zKGxpZ2h0c0xpc3RbbGlnaHRJbmRleF0uY3V0b2Zmcy54KSkgLyBlcHNpbG9uLCAwLjAsIDEuMCk7CgkJCQkJbGV0IGxjOiB2ZWMzZiA9IGxpZ2h0c0xpc3RbbGlnaHRJbmRleF0uY29sb3I7CgkJCQkJbG9jYWxDb2xvciArPSBzaGFkZShwLCB0bXBkLCBuLCBsLCBsYyAqIGludGVuc2l0eSwgZGlmZnVzZSAqIGludGVuc2l0eSwgbWV0YWxsaWMsIHJvdWdobmVzcykgKiBzaGFkb3dzKHAsIG4sIGwpOwoJCQkJfQoJCQl9CgkJCWxvY2FsQ29sb3IgKj0gYW87CgkJCWxvY2FsQ29sb3IgPSBtaXgobG9jYWxDb2xvciwgYmFja2dyb3VuZChwKSwgMS4wIC0gZXhwKC1mb2dEZW5zaXR5ICogb2JqZWN0LmRpc3QgKiBvYmplY3QuZGlzdCkpOwoJCX0KCQllbHNlIHsKCQkJY29sb3IgKz0gYmFja2dyb3VuZChwKSAqIGZyYWM7CgkJCXJldHVybiBjb2xvcjsKCQl9CgoJCWNvbG9yICs9IGxvY2FsQ29sb3IgKiBmcmFjOwoJCWZyYWMgKj0gbWV0YWxsaWM7CgoJCS8vIEVhcmx5IHN0b3AgYXMgdGhlIGltcGFjdCBvbiB0aGUgZmluYWwgY29sb3Igd2lsbCBub3QgYmUgY29uc2VxdWVudAoJCWlmIChmcmFjIDwgMC4wNSkgewoJCQlicmVhazsKCQl9CgoJCXRtcG8gPSBwICsgKG4gKiBFUFNJTE9OKTsKCQl0bXBkID0gcmVmbGVjdCh0bXBkLCBuKTsKCX0KCglyZXR1cm4gY29sb3I7Cn0KCkBmcmFnbWVudApmbiBtYWluKEBsb2NhdGlvbigwKSB1djogdmVjMmYpIC0+IEBsb2NhdGlvbigwKSB2ZWM0ZiB7CglsZXQgY2FtZXJhTWF0cml4OiBtYXQzeDNmID0gY2FtZXJhKCk7CgoJbGV0IGRpbTogdmVjMmYgPSB2ZWMyZihmMzIocmVzb2x1dGlvbi54KSwgZjMyKHJlc29sdXRpb24ueSkpOwoJbGV0IG5ld1V2OiB2ZWMyZiA9ICgyLjAgKiAodXYgKiBkaW0pIC0gZGltKSAvIGRpbS55OwoJbGV0IGQ6IHZlYzNmID0gY2FtZXJhTWF0cml4ICogbm9ybWFsaXplKHZlYzNmKG5ld1V2LCAyLjApKTsKCglsZXQgY29sb3I6IHZlYzNmID0gcmVuZGVyKGNhbWVyYVBvc2l0aW9uLCBkKTsKCglyZXR1cm4gdmVjNGYoY29sb3IsIDEuMCk7Cn0K)
