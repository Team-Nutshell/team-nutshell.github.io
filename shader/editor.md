# WebGPU Shader Editor

<script src="shader_editor.js" defer></script>
<p id="webgpuCheck"></p>
<center>
	<canvas id="webgpuCanvas" width="980" height="550"></canvas>
</center>
<div style="height: 275px;">
	<textarea class="highlight" id="webgpuFragmentShader" spellcheck="false" style="width: 95%; height: 100%; overflow-y: scroll; white-space: break-spaces; padding: 10px; border-style: solid; border-width: 1px; resize: none;"></textarea>
	<button id="webgpuRefreshFragmentShader" style="width: 5%; height: 100%; float: right;">Run</button>
</div>
<p class="highlight" id="webgpuFragmentShaderCompilationMessage" style="width: 100%; height: 115px; overflow-y: scroll; white-space: break-spaces; padding: 10px; border-style: solid; border-width: 1px; border-color: rgb(100, 15, 0);"></p>

Click on the canvas to control the camera.

Use **WASD** to move the camera.

Use **arrow keys** to rotate the camera.

Use **space** to go up and **left shift** to go down.

Pre-defined variables:
```
time: f32 - Current timestamp in seconds, starting from 0.0 at application launch.
cameraPosition: vec3f - Current position of the camera, starting at vec3f(0.0, 0.0, 0.0).
cameraDirection: vec3f - Current direction of the camera, starting at vec3f(0.0, 0.0, 1.0).
resolution: vec2u - Resolution, is 980u by 600u pixels.
mouse: vec2i - Mouse position in pixels, top-left corner is (0, 0).
```

## Examples
- [Mouse position](https://www.team-nutshell.dev/shader/editor.html#QGZyYWdtZW50CmZuIG1haW4oQGxvY2F0aW9uKDApIHV2OiB2ZWMyZikgLT4gQGxvY2F0aW9uKDApIHZlYzRmIHsKCWxldCBtb3VzZVJlbGF0aXZlOiB2ZWMyZiA9IHZlYzJmKGYzMihtb3VzZS54KSAvIGYzMihyZXNvbHV0aW9uLngpLCBmMzIobW91c2UueSkgLyBmMzIocmVzb2x1dGlvbi55KSk7CgoJcmV0dXJuIHZlYzRmKGRpc3RhbmNlKG1vdXNlUmVsYXRpdmUsIHZlYzJmKHV2LngsIDEuMCAtIHV2LnkpKSwgMC4wLCAwLjAsIDEuMCk7Cn0K)
- [Weird Nutshell](https://www.team-nutshell.dev/shader/editor.html#Y29uc3QgTV9QSTogZjMyID0gMy4xNDE1OTI2NTM1ODk3OTMyMzg0NjI2NDMzODMyNzk1OwoKY29uc3QgTUFYX1NURVBTOiB1MzIgPSAyNTZ1Owpjb25zdCBNQVhfRElTVEFOQ0U6IGYzMiA9IDEwMDAuMDsKY29uc3QgRVBTSUxPTjogZjMyID0gMC4wMDAxOwpjb25zdCBNQVhfQk9VTkNFUzogdTMyID0gMXU7CgpzdHJ1Y3QgTWF0ZXJpYWwgewoJZGlmZnVzZTogdmVjM2YsCgltZXRhbGxpY1JvdWdobmVzczogdmVjMmYKfQoKc3RydWN0IE9iamVjdCB7CglkaXN0OiBmMzIsCgltYXQ6IE1hdGVyaWFsCn0KCnN0cnVjdCBMaWdodCB7CglsaWdodFR5cGU6IHUzMiwgLy8gMCA9IERpcmVjdGlvbmFsLCAxID0gUG9pbnQsIDIgPSBTcG90Cglwb3NpdGlvbjogdmVjM2YsCglkaXJlY3Rpb246IHZlYzNmLAoJY29sb3I6IHZlYzNmLAoJY3V0b2ZmczogdmVjMmYKfQoKLy8gR0xTTC10eXBlIG1vZCgpCmZuIGdsc2xtb2QoYTogZjMyLCBiOiBmMzIpIC0+IGYzMiB7Cgl2YXIgbTogZjMyID0gYSAlIGI7CglpZiAobSA8IDAuMCkgewoJCWlmIChiIDwgMC4wKSB7CgkJCW0gLT0gYjsKCQl9IGVsc2UgewoJCQltICs9IGI7CgkJfQoJfQoKCXJldHVybiBtOwp9CgovLyBSYW5kb20KZm4gcmFuZDJEKHNlZWQ6IHZlYzJmKSAtPiBmMzIgewoJcmV0dXJuIGZyYWN0KHNpbihkb3Qoc2VlZCwgdmVjMmYoMTIuOTg5OCwgNzguMjMzKSkpICogNDM3NTguNTQ1MzEyMyk7Cn0KCmZuIG5vaXNlMkQoc2VlZDogdmVjMmYpIC0+IGYzMiB7CglsZXQgaTogdmVjMmYgPSBmbG9vcihzZWVkKTsKCWxldCBmOiB2ZWMyZiA9IGZyYWN0KHNlZWQpOwoKCWxldCBhOiBmMzIgPSByYW5kMkQoaSk7CglsZXQgYjogZjMyID0gcmFuZDJEKGkgKyB2ZWMyZigxLjAsIDAuMCkpOwoJbGV0IGM6IGYzMiA9IHJhbmQyRChpICsgdmVjMmYoMC4wLCAxLjApKTsKCWxldCBkOiBmMzIgPSByYW5kMkQoaSArIHZlYzJmKDEuMCwgMS4wKSk7CgoJbGV0IHU6IHZlYzJmID0gc21vb3Roc3RlcCh2ZWMyZigwLjApLCB2ZWMyZigxLjApLCBmKTsKCglyZXR1cm4gbWl4KGEsIGIsIHUueCkgKyAoYyAtIGEpICogdS55ICogKDEuMCAtIHUueCkgKyAoZCAtIGIpICogdS54ICogdS55Owp9CgpmbiBmYm0ocDogdmVjMmYpIC0+IGYzMiB7CglsZXQgY2EgPSBjb3MoTV9QSSAvIDQuMCk7CglsZXQgc2EgPSBzaW4oTV9QSSAvIDQuMCk7Cgl2YXIgcHRtcDogdmVjMmYgPSBwOwoJdmFyIHJlczogZjMyID0gMC4wOwoJdmFyIGFtcDogZjMyID0gMC41OwoJbGV0IGZyZXE6IGYzMiA9IDEuOTU7Cglmb3IodmFyIGk6IHUzMiA9IDB1OyBpIDwgMnU7IGkrKykgewoJCXJlcyArPSBhbXAgKiBub2lzZTJEKHB0bXApOwoJCWFtcCAqPSAwLjU7CgkJcHRtcCA9IHB0bXAgKiBmcmVxICogbWF0MngyZihjYSwgLXNhLCBzYSwgY2EpIC0gcmVzICogMC40OwoJfQoKCXJldHVybiByZXM7Cn0KCi8vIFNoYXBlcwovLyBTcGhlcmUKLy8gciA9IHJhZGl1cwpmbiBzaFNwaGVyZShwOiB2ZWMzZiwgcjogZjMyKSAtPiBmMzIgewoJcmV0dXJuIGxlbmd0aChwKSAtIHI7Cn0KCi8vIFRyaWFuZ3VsYXIgcHJpc20KZm4gc2hUcmlhbmd1bGFyUHJpc20ocDogdmVjM2YsIGg6IHZlYzJmKSAtPiBmMzIgewoJbGV0IHE6IHZlYzNmID0gYWJzKHApOwoKCXJldHVybiBtYXgocS56IC0gaC55LCBtYXgocS54ICogMC44NjYwMjUgKyBwLnkgKiAwLjUsIC1wLnkpIC0gaC54ICogMC41KTsKfQoKLy8gT3BlcmF0aW9ucwpmbiBvcFNtb290aFVuaW9uKGE6IE9iamVjdCwgYjogT2JqZWN0LCBrOiBmMzIpIC0+IE9iamVjdCB7CglsZXQgaDogZjMyID0gbWF4KGsgLSBhYnMoYS5kaXN0IC0gYi5kaXN0KSwgMC4wKTsKCWxldCBuZXdEaXN0OiBmMzIgPSBtaW4oYS5kaXN0LCBiLmRpc3QpIC0gaCAqIGggKiAwLjI1IC8gazsKCglsZXQgYmY6IGYzMiA9IChoIC8gaykgKiAoaCAvIGspICogMC41OwoJdmFyIGJsZW5kRmFjdG9yOiBmMzI7CglpZiAoYS5kaXN0IDwgYi5kaXN0KSB7CgkJYmxlbmRGYWN0b3IgPSBiZjsKCX0KCWVsc2UgewoJCWJsZW5kRmFjdG9yID0gKDEuMCAtIGJmKTsKCX0KCglsZXQgbmV3TWF0OiBNYXRlcmlhbCA9IE1hdGVyaWFsKG1peChhLm1hdC5kaWZmdXNlLCBiLm1hdC5kaWZmdXNlLCBibGVuZEZhY3RvciksIG1peChhLm1hdC5tZXRhbGxpY1JvdWdobmVzcywgYi5tYXQubWV0YWxsaWNSb3VnaG5lc3MsIGJsZW5kRmFjdG9yKSk7CgoJcmV0dXJuIE9iamVjdChuZXdEaXN0LCBuZXdNYXQpOwp9CgpmbiBvcFNtb290aEludGVyc2VjdGlvbihhOiBPYmplY3QsIGI6IE9iamVjdCwgazogZjMyKSAtPiBPYmplY3QgewoJdmFyIG9iamVjdDogT2JqZWN0ID0gb3BTbW9vdGhVbmlvbihPYmplY3QoLWEuZGlzdCwgYS5tYXQpLCBPYmplY3QoLWIuZGlzdCwgYi5tYXQpLCBrKTsKCW9iamVjdC5kaXN0ICo9IC0xLjA7CgoJcmV0dXJuIG9iamVjdDsKfQoKZm4gb3BTbW9vdGhEaWZmZXJlbmNlKGE6IE9iamVjdCwgYjogT2JqZWN0LCBrOiBmMzIpIC0+IE9iamVjdCB7Cgl2YXIgb2JqZWN0OiBPYmplY3QgPSBvcFNtb290aFVuaW9uKGIsIE9iamVjdCgtYS5kaXN0LCBhLm1hdCksIGspOwoJb2JqZWN0LmRpc3QgKj0gLTEuMDsKCglyZXR1cm4gb2JqZWN0Owp9CgovLyBUcmFuc2Zvcm0KZm4gcm90YXRlKHA6IHZlYzJmLCBhbmdsZTogZjMyKSAtPiB2ZWMyZiB7CglyZXR1cm4gY29zKGFuZ2xlKSAqIHAgKyBzaW4oYW5nbGUpICogdmVjMmYocC55LCAtcC54KTsKfQoKLy8gUmF5IEluZmluaXRlIFJlcGVhdAovLyBwID0gcmF5IHBvc2l0aW9uCi8vIG4gPSBwZXJpb2Qgb24gZWFjaCBheGlzCmZuIHJheVJlcGVhdChwOiB2ZWMzZiwgbjogdmVjM2YpIC0+IHZlYzNmIHsKCXJldHVybiB2ZWMzZihnbHNsbW9kKHAueCwgbi54KSwgZ2xzbG1vZChwLnksIG4ueSksIGdsc2xtb2QocC56LCBuLnopKSAtIChuIC8gMi4wKTsKfQoKLy8gU2NlbmUKZm4gcFIocDogdmVjMmYpIC0+IHZlYzJmIHsKCWxldCBhOiBmMzIgPSBzaW4oMC41ICogdGltZSk7CgoJcmV0dXJuIGNvcyhhKSAqIHAueHkgKyBzaW4oYSkgKiB2ZWMyZihwLnksIC1wLngpOwp9CgpmbiBkaXNwbGFjZShwOiB2ZWMzZikgLT4gZjMyIHsKCXJldHVybiBzaW4ocC54ICsgNC4wICogdGltZSkgKiBzaW4ocC55ICsgc2luKDIuMCAqIHRpbWUpKSAqIHNpbihwLnogKyA2LjAgKiB0aW1lKTsKfQoKZm4gc2NlbmUocDogdmVjM2YpIC0+IE9iamVjdCB7CglsZXQgbnV0c2hlbGxXb3JsZFBvc2l0aW9uOiB2ZWMzZiA9IHZlYzNmKDAuMCwgMC4wLCAxNS4wKTsKCWxldCBwTnV0c2hlbGxIb2xlOiB2ZWMzZiA9IHZlYzNmKHJvdGF0ZShwLnh5LCAxLjUpLCBwLnopOwoJdmFyIHAyOiB2ZWMzZiA9IHZlYzNmKHAueCwgcFIocC55eikpOwoJcDIgPSByYXlSZXBlYXQocCwgdmVjM2YoNS4wKSk7CglsZXQgc3BoZXJlOiBPYmplY3QgPSBPYmplY3Qoc2hTcGhlcmUocCAtIG51dHNoZWxsV29ybGRQb3NpdGlvbiwgNS4wICsgZGlzcGxhY2UocDIpKSwgTWF0ZXJpYWwodmVjM2YoMS4wLCAxLjAsIDEuMCksIHZlYzJmKDAuNSAsIDEuMCkpKTsKCWxldCBudXRzaGVsbEhvbGU6IE9iamVjdCA9IE9iamVjdChzaFRyaWFuZ3VsYXJQcmlzbShwTnV0c2hlbGxIb2xlIC0gdmVjM2YoLTEuMCwgLTMuNSwgMC4wKSAtIG51dHNoZWxsV29ybGRQb3NpdGlvbiwgdmVjMmYoNy4wLCA1LjApKSwgTWF0ZXJpYWwodmVjM2YoMC4wLCAwLjAsIDAuMCksIHZlYzJmKDAuMCwgMC41KSkpOwoKCWxldCBzY2VuZTogT2JqZWN0ID0gb3BTbW9vdGhEaWZmZXJlbmNlKHNwaGVyZSwgbnV0c2hlbGxIb2xlLCAyLjApOwoKCXJldHVybiBzY2VuZTsKfQoKLy8gQmFja2dyb3VuZApmbiBiYWNrZ3JvdW5kKHA6IHZlYzNmKSAtPiB2ZWMzZiB7CglyZXR1cm4gdmVjM2YoZmJtKHAuengpLCBmYm0ocC55eCksIGZibShwLnh5KSk7Cn0KCi8vIENhbWVyYQpjb25zdCB1cDogdmVjM2YgPSB2ZWMzZigwLjAsIDEuMCwgMC4wKTsKCmZuIGNhbWVyYSgpIC0+IG1hdDN4M2YgewoJbGV0IGZvcndhcmQ6IHZlYzNmID0gbm9ybWFsaXplKGNhbWVyYURpcmVjdGlvbik7CglsZXQgcmlnaHQ6IHZlYzNmID0gbm9ybWFsaXplKGNyb3NzKHVwLCBmb3J3YXJkKSk7CglsZXQgcmVhbFVwOiB2ZWMzZiA9IGNyb3NzKGZvcndhcmQsIHJpZ2h0KTsKCglyZXR1cm4gbWF0M3gzZihyaWdodCwgcmVhbFVwLCBmb3J3YXJkKTsKfQoKLy8gTGlnaHRzCmNvbnN0IExJR0hUU19DT1VOVDogdTMyID0gMnU7CmZuIGxpZ2h0cygpIC0+IGFycmF5PExpZ2h0LCBMSUdIVFNfQ09VTlQ+IHsKCXZhciBsOiBhcnJheTxMaWdodCwgTElHSFRTX0NPVU5UPjsKCWxbMF0gPSBMaWdodCgwdSwgdmVjM2YoMC4wKSwgdmVjM2YoMS4wLCAtMS4wLCAwLjApLCB2ZWMzZigxLjAsIDEuMCwgMS4wKSwgdmVjMmYoMC4wKSk7CglsWzFdID0gTGlnaHQoMXUsIHZlYzNmKDEuMCwgMS4wLCAwLjApLCB2ZWMzZigwLjApLCB2ZWMzZigxLjAsIDAuMCwgMC4wKSwgdmVjMmYoMC4wKSk7CgkKCXJldHVybiBsOwp9CgpmbiByYXltYXJjaChvOiB2ZWMzZiwgZDogdmVjM2YpIC0+IE9iamVjdCB7Cgl2YXIgb2JqZWN0OiBPYmplY3QgPSBPYmplY3QoMC4wLCBNYXRlcmlhbCh2ZWMzZigwLjApLCB2ZWMyZigwLjApKSk7Cglmb3IgKHZhciBpOiB1MzIgPSAwdTsgaSA8IE1BWF9TVEVQUzsgaSsrKSB7CgkJbGV0IHA6IHZlYzNmID0gbyArIG9iamVjdC5kaXN0ICogZDsKCQlsZXQgb2JqZWN0SGl0OiBPYmplY3QgPSBzY2VuZShwKTsKCQlpZiAoYWJzKG9iamVjdEhpdC5kaXN0KSA8IEVQU0lMT04pIHsKCQkJYnJlYWs7CgkJfQoJCW9iamVjdC5kaXN0ICs9IG9iamVjdEhpdC5kaXN0OwoJCW9iamVjdC5tYXQgPSBvYmplY3RIaXQubWF0OwoJCWlmIChvYmplY3QuZGlzdCA+IE1BWF9ESVNUQU5DRSkgewoJCQlicmVhazsKCQl9Cgl9CgoJcmV0dXJuIG9iamVjdDsKfQoKLy8gQ29tcHV0ZSBub3JtYWwKZm4gbm9ybWFsKHA6IHZlYzNmKSAtPiB2ZWMzZiB7CglsZXQgZTogdmVjMmYgPSB2ZWMyZihFUFNJTE9OLCAwLjApOwoJbGV0IG46IHZlYzNmID0gdmVjM2Yoc2NlbmUocCkuZGlzdCkgLSB2ZWMzZihzY2VuZShwIC0gZS54eXkpLmRpc3QsIHNjZW5lKHAgLSBlLnl4eSkuZGlzdCwgc2NlbmUocCAtIGUueXl4KS5kaXN0KTsKCglyZXR1cm4gbm9ybWFsaXplKG4pOwp9CgovLyBCUkRGCmZuIGRpc3RyaWJ1dGlvbihOZG90SDogZjMyLCByb3VnaG5lc3M6IGYzMikgLT4gZjMyIHsKCWxldCBhOiBmMzIgPSByb3VnaG5lc3MgKiByb3VnaG5lc3M7CglsZXQgYVNxdWFyZTogZjMyID0gYSAqIGE7CglsZXQgTmRvdEhTcXVhcmU6IGYzMiA9IE5kb3RIICogTmRvdEg7CglsZXQgZGVub206IGYzMiA9IE5kb3RIU3F1YXJlICogKGFTcXVhcmUgLSAxLjApICsgMS4wOwoKCXJldHVybiBhU3F1YXJlIC8gKE1fUEkgKiBkZW5vbSAqIGRlbm9tKTsKfQoKZm4gZnJlc25lbChjb3NUaGV0YTogZjMyLCBmMDogdmVjM2YpIC0+IHZlYzNmIHsKCXJldHVybiBmMCArICgxLjAgLSBmMCkgKiBwb3coMS4wIC0gY29zVGhldGEsIDUuMCk7Cn0KCmZuIGcoTmRvdFY6IGYzMiwgcm91Z2huZXNzOiBmMzIpIC0+IGYzMiB7CglsZXQgcjogZjMyID0gcm91Z2huZXNzICsgMS4wOwoJbGV0IGs6IGYzMiA9IChyICogcikgLyA4LjA7CglsZXQgZGVub206IGYzMiA9IE5kb3RWICogKDEuMCAtIGspICsgazsKCglyZXR1cm4gTmRvdFYgLyBkZW5vbTsKfQoKZm4gc21pdGgoTGRvdE46IGYzMiwgVmRvdE46IGYzMiwgcm91Z2huZXNzOiBmMzIpIC0+IGYzMiB7CglsZXQgZ3Y6IGYzMiA9IGcoVmRvdE4sIHJvdWdobmVzcyk7CglsZXQgZ2w6IGYzMiA9IGcoTGRvdE4sIHJvdWdobmVzcyk7CgoJcmV0dXJuIGd2ICogZ2w7Cn0KCmZuIGRpZmZ1c2VGcmVzbmVsQ29ycmVjdGlvbihpb3I6IHZlYzNmKSAtPiB2ZWMzZiB7CglsZXQgaW9yU3F1YXJlOiB2ZWMzZiA9IGlvciAqIGlvcjsKCXZhciBUSVI6IHZlYzNmOwoJaWYgKGlvci54IDwgMS4wKSB7CgkJVElSLnggPSAxLjA7Cgl9CgllbHNlIHsKCQlUSVIueCA9IDAuMDsKCX0KCWlmIChpb3IueSA8IDEuMCkgewoJCVRJUi55ID0gMS4wOwoJfQoJZWxzZSB7CgkJVElSLnkgPSAwLjA7Cgl9CglpZiAoaW9yLnogPCAxLjApIHsKCQlUSVIueiA9IDEuMDsKCX0KCWVsc2UgewoJCVRJUi56ID0gMC4wOwoJfQoJbGV0IGludkRlbnVtOiB2ZWMzZiA9IG1peCh2ZWMzZigxLjApLCB2ZWMzZigxLjApIC8gKGlvclNxdWFyZSAqIGlvclNxdWFyZSAqICh2ZWMzZig1NTQuMzMpICogMzgwLjcgKiBpb3IpKSwgVElSKTsKCXZhciBudW06IHZlYzNmID0gaW9yICogbWl4KHZlYzNmKDAuMTkyMTE1NjEwMjI1MTA4OCksIGlvciAqIDI5OC4yNSAtIDI2MS4zOCAqIGlvclNxdWFyZSArIDEzOC40MywgVElSKTsKCW51bSArPSBtaXgodmVjM2YoMC44MDc4ODQzODk3NzQ4OTEyKSwgdmVjM2YoLTEuMDcpLCBUSVIpOwoKCXJldHVybiBudW0gKiBpbnZEZW51bTsKfQoKZm4gYnJkZihMZG90SDogZjMyLCBOZG90SDogZjMyLCBWZG90SDogZjMyLCBMZG90TjogZjMyLCBWZG90TjogZjMyLCBkaWZmdXNlOiB2ZWMzZiwgbWV0YWxsaWM6IGYzMiwgcm91Z2huZXNzOiBmMzIpIC0+IHZlYzNmIHsKCWxldCBkOiBmMzIgPSBkaXN0cmlidXRpb24oTmRvdEgsIHJvdWdobmVzcyk7CglsZXQgZjogdmVjM2YgPSBmcmVzbmVsKExkb3RILCBtaXgodmVjM2YoMC4wNCksIGRpZmZ1c2UsIG1ldGFsbGljKSk7CglsZXQgZlQ6IHZlYzNmID0gZnJlc25lbChMZG90TiwgbWl4KHZlYzNmKDAuMDQpLCBkaWZmdXNlLCBtZXRhbGxpYykpOwoJbGV0IGZUSVI6IHZlYzNmID0gZnJlc25lbChWZG90TiwgbWl4KHZlYzNmKDAuMDQpLCBkaWZmdXNlLCBtZXRhbGxpYykpOwoJbGV0IGc6IGYzMiA9IHNtaXRoKExkb3ROLCBWZG90Tiwgcm91Z2huZXNzKTsKCWxldCBkZmM6IHZlYzNmID0gZGlmZnVzZUZyZXNuZWxDb3JyZWN0aW9uKHZlYzNmKDEuMDUpKTsKCglsZXQgbGFtYmVydGlhbjogdmVjM2YgPSBkaWZmdXNlIC8gTV9QSTsKCglyZXR1cm4gKGQgKiBmICogZykgLyBtYXgoNC4wICogTGRvdE4gKiBWZG90TiwgMC4wMDEpICsgKCh2ZWMzZigxLjApIC0gZlQpICogKHZlYzNmKDEuMCAtIGZUSVIpKSAqIGxhbWJlcnRpYW4pICogZGZjOwp9CgpmbiBzaGFkZShwOiB2ZWMzZiwgZDogdmVjM2YsIG46IHZlYzNmLCBsaWdodFBvczogdmVjM2YsIGxpZ2h0Q29sb3I6IHZlYzNmLCBkaWZmdXNlOiB2ZWMzZiwgbWV0YWxsaWM6IGYzMiwgcm91Z2huZXNzOiBmMzIpIC0+IHZlYzNmIHsKCWxldCBsOiB2ZWMzZiA9IG5vcm1hbGl6ZShsaWdodFBvcyAtIHApOwoJbGV0IHY6IHZlYzNmID0gLWQ7CglsZXQgaDogdmVjM2YgPSBub3JtYWxpemUodiArIGwpOwoKCWxldCBMZG90SDogZjMyID0gbWF4KGRvdChsLCBoKSwgMC4wKTsKCWxldCBOZG90SDogZjMyID0gbWF4KGRvdChuLCBoKSwgMC4wKTsKCWxldCBWZG90SDogZjMyID0gbWF4KGRvdCh2LCBoKSwgMC4wKTsKCWxldCBMZG90TjogZjMyID0gbWF4KGRvdChsLCBuKSwgMC4wKTsKCWxldCBWZG90TjogZjMyID0gbWF4KGRvdCh2LCBuKSwgMC4wKTsKCglsZXQgYnJkZjogdmVjM2YgPSBicmRmKExkb3RILCBOZG90SCwgVmRvdEgsIExkb3ROLCBWZG90TiwgZGlmZnVzZSwgbWV0YWxsaWMsIHJvdWdobmVzcyk7CgkKCXJldHVybiBsaWdodENvbG9yICogYnJkZiAqIExkb3ROOwp9CgovLyBTaGFkb3dzCmZuIHNoYWRvd3MocDogdmVjM2YsIG46IHZlYzNmLCBsaWdodFBvczogdmVjM2YpIC0+IGYzMiB7Cgl2YXIgcmVzOiBmMzIgPSAxLjA7Cgl2YXIgZGlzdDogZjMyID0gMC4wMTsKCWxldCBsaWdodFNpemU6IGYzMiA9IDAuMTU7Cglmb3IgKHZhciBpOiB1MzIgPSAwdTsgaSA8IE1BWF9TVEVQUzsgaSsrKSB7CgkJbGV0IGhpdDogZjMyID0gc2NlbmUocCArIGxpZ2h0UG9zICogZGlzdCkuZGlzdDsKCQlyZXMgPSBtaW4ocmVzLCBoaXQgLyAoZGlzdCAqIGxpZ2h0U2l6ZSkpOwoJCWRpc3QgKz0gaGl0OwoJCWlmIChoaXQgPCBFUFNJTE9OIHx8IGRpc3QgPiA2MC4wKSB7CgkJCWJyZWFrOwoJCX0KCX0KCglyZXR1cm4gY2xhbXAocmVzLCAwLjAsIDEuMCk7Cn0KCi8vIEFtYmllbnQgT2NjbHVzaW9uCmZuIGFtYmllbnRPY2NsdXNpb24ocDogdmVjM2YsIG46IHZlYzNmKSAtPiBmMzIgewoJdmFyIGFvOiBmMzIgPSAwLjA7Cgl2YXIgd2VpZ2h0OiBmMzIgPSAxLjA7Cglmb3IgKHZhciBpOiB1MzIgPSAwdTsgaSA8IDh1OyBpKyspIHsKCQlsZXQgbGVuOiBmMzIgPSAwLjAxICsgMC4wMiAqIGYzMihpICogaSk7CgkJbGV0IGRpc3Q6IGYzMiA9IHNjZW5lKHAgKyBuICogbGVuKS5kaXN0OwoJCWFvICs9IChsZW4gLSBkaXN0KSAqIHdlaWdodDsKCQl3ZWlnaHQgKj0gMC44NTsKCX0KCglyZXR1cm4gMS4wIC0gY2xhbXAoMC42ICogYW8sIDAuMCwgMS4wKTsKfQoKLy8gUmVuZGVyCmZuIHJlbmRlcihvOiB2ZWMzZiwgZDogdmVjM2YpIC0+IHZlYzNmIHsKCXZhciB0bXBvOiB2ZWMzZiA9IG87Cgl2YXIgdG1wZDogdmVjM2YgPSBkOwoKCXZhciBsaWdodHNMaXN0OiBhcnJheTxMaWdodCwgTElHSFRTX0NPVU5UPiA9IGxpZ2h0cygpOwoKCWxldCBmb2dEZW5zaXR5OiBmMzIgPSAwLjAwMDg7CgoJdmFyIGZyYWM6IGYzMiA9IDEuMDsKCXZhciBjb2xvcjogdmVjM2YgPSB2ZWMzZigwLjAsIDAuMCwgMC4wKTsKCWZvciAodmFyIGRlcHRoOiB1MzIgPSAwdTsgZGVwdGggPCBNQVhfQk9VTkNFUyArIDF1OyBkZXB0aCsrKSB7CgkJdmFyIGxvY2FsQ29sb3I6IHZlYzNmID0gdmVjM2YoMC4wLCAwLjAsIDAuMCk7CgoJCS8vIFJheW1hcmNoCgkJbGV0IG9iamVjdDogT2JqZWN0ID0gcmF5bWFyY2godG1wbywgdG1wZCk7CgkJbGV0IHA6IHZlYzNmID0gdG1wbyArIG9iamVjdC5kaXN0ICogdG1wZDsKCQkKCQlsZXQgbjogdmVjM2YgPSBub3JtYWwocCk7CgkJbGV0IG1ldGFsbGljOiBmMzIgPSBvYmplY3QubWF0Lm1ldGFsbGljUm91Z2huZXNzLng7CgkJaWYgKG9iamVjdC5kaXN0IDw9IE1BWF9ESVNUQU5DRSkgewoJCQkvLyBPYmplY3QgcHJvcGVydGllcwoJCQlsZXQgZGlmZnVzZTogdmVjM2YgPSBvYmplY3QubWF0LmRpZmZ1c2U7CgkJCWxldCByb3VnaG5lc3M6IGYzMiA9IG9iamVjdC5tYXQubWV0YWxsaWNSb3VnaG5lc3MueTsKCQkJbGV0IGFvOiBmMzIgPSBhbWJpZW50T2NjbHVzaW9uKHAsIG4pOwoKCQkJLy8gTG9jYWwgY29sb3IKCQkJZm9yICh2YXIgbGlnaHRJbmRleDogdTMyID0gMHU7IGxpZ2h0SW5kZXggPCBMSUdIVFNfQ09VTlQ7IGxpZ2h0SW5kZXgrKykgewoJCQkJLy8gRGlyZWN0aW9uYWwgTGlnaHQKCQkJCWlmIChsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmxpZ2h0VHlwZSA9PSAwdSkgewoJCQkJCWxldCBsOiB2ZWMzZiA9IG5vcm1hbGl6ZSgtbGlnaHRzTGlzdFtsaWdodEluZGV4XS5kaXJlY3Rpb24pOwoJCQkJCWxldCBsYzogdmVjM2YgPSBsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmNvbG9yOwoJCQkJCWxvY2FsQ29sb3IgKz0gc2hhZGUocCwgdG1wZCwgbiwgbCwgbGMsIGRpZmZ1c2UsIG1ldGFsbGljLCByb3VnaG5lc3MpICogc2hhZG93cyhwLCBuLCBsKTsKCQkJCX0KCQkJCS8vIFBvaW50IExpZ2h0CgkJCQllbHNlIGlmIChsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmxpZ2h0VHlwZSA9PSAxdSkgewoJCQkJCWxldCBsOiB2ZWMzZiA9IG5vcm1hbGl6ZShsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLnBvc2l0aW9uIC0gcCk7CgkJCQkJbGV0IGRpc3RhbmNlOiBmMzIgPSBsZW5ndGgobGlnaHRzTGlzdFtsaWdodEluZGV4XS5wb3NpdGlvbiAtIHApOwoJCQkJCWxldCBhdHRlbnVhdGlvbjogZjMyID0gMS4wIC8gKGRpc3RhbmNlICogZGlzdGFuY2UpOwoJCQkJCWxldCBsYzogdmVjM2YgPSBsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmNvbG9yICogYXR0ZW51YXRpb247CgkJCQkJbG9jYWxDb2xvciArPSBzaGFkZShwLCB0bXBkLCBuLCBsLCBsYywgZGlmZnVzZSwgbWV0YWxsaWMsIHJvdWdobmVzcykgKiBzaGFkb3dzKHAsIG4sIGwpOwoJCQkJfQoJCQkJLy8gU3BvdCBMaWdodAoJCQkJZWxzZSBpZiAobGlnaHRzTGlzdFtsaWdodEluZGV4XS5saWdodFR5cGUgPT0gMnUpIHsKCQkJCQlsZXQgbDogdmVjM2YgPSBub3JtYWxpemUobGlnaHRzTGlzdFtsaWdodEluZGV4XS5wb3NpdGlvbiAtIHApOwoJCQkJCWxldCBsZDogdmVjM2YgPSBsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmRpcmVjdGlvbjsKCQkJCQlsZXQgdGhldGE6IGYzMiA9IGRvdChsLCBub3JtYWxpemUoLWxkKSk7CgkJCQkJbGV0IGVwc2lsb246IGYzMiA9IGNvcyhsaWdodHNMaXN0W2xpZ2h0SW5kZXhdLmN1dG9mZnMueSAtIGxpZ2h0c0xpc3RbbGlnaHRJbmRleF0uY3V0b2Zmcy54KTsKCQkJCQlsZXQgaW50ZW5zaXR5OiBmMzIgPSBjbGFtcCgodGhldGEgLSBjb3MobGlnaHRzTGlzdFtsaWdodEluZGV4XS5jdXRvZmZzLngpKSAvIGVwc2lsb24sIDAuMCwgMS4wKTsKCQkJCQlsZXQgbGM6IHZlYzNmID0gbGlnaHRzTGlzdFtsaWdodEluZGV4XS5jb2xvcjsKCQkJCQlsb2NhbENvbG9yICs9IHNoYWRlKHAsIHRtcGQsIG4sIGwsIGxjICogaW50ZW5zaXR5LCBkaWZmdXNlICogaW50ZW5zaXR5LCBtZXRhbGxpYywgcm91Z2huZXNzKSAqIHNoYWRvd3MocCwgbiwgbCk7CgkJCQl9CgkJCX0KCQkJbG9jYWxDb2xvciAqPSBhbzsKCQkJbG9jYWxDb2xvciA9IG1peChsb2NhbENvbG9yLCBiYWNrZ3JvdW5kKHApLCAxLjAgLSBleHAoLWZvZ0RlbnNpdHkgKiBvYmplY3QuZGlzdCAqIG9iamVjdC5kaXN0KSk7CgkJfQoJCWVsc2UgewoJCQljb2xvciArPSBiYWNrZ3JvdW5kKHApICogZnJhYzsKCQkJcmV0dXJuIGNvbG9yOwoJCX0KCgkJY29sb3IgKz0gbG9jYWxDb2xvciAqIGZyYWM7CgkJZnJhYyAqPSBtZXRhbGxpYzsKCgkJLy8gRWFybHkgc3RvcCBhcyB0aGUgaW1wYWN0IG9uIHRoZSBmaW5hbCBjb2xvciB3aWxsIG5vdCBiZSBjb25zZXF1ZW50CgkJaWYgKGZyYWMgPCAwLjA1KSB7CgkJCWJyZWFrOwoJCX0KCgkJdG1wbyA9IHAgKyAobiAqIEVQU0lMT04pOwoJCXRtcGQgPSByZWZsZWN0KHRtcGQsIG4pOwoJfQoKCXJldHVybiBjb2xvcjsKfQoKQGZyYWdtZW50CmZuIG1haW4oQGxvY2F0aW9uKDApIHV2OiB2ZWMyZikgLT4gQGxvY2F0aW9uKDApIHZlYzRmIHsKCWxldCBjYW1lcmFNYXRyaXg6IG1hdDN4M2YgPSBjYW1lcmEoKTsKCglsZXQgZGltOiB2ZWMyZiA9IHZlYzJmKGYzMihyZXNvbHV0aW9uLngpLCBmMzIocmVzb2x1dGlvbi55KSk7CglsZXQgbmV3VXY6IHZlYzJmID0gKDIuMCAqICh1diAqIGRpbSkgLSBkaW0pIC8gZGltLnk7CglsZXQgZDogdmVjM2YgPSBjYW1lcmFNYXRyaXggKiBub3JtYWxpemUodmVjM2YobmV3VXYsIDIuMCkpOwoKCWxldCBjb2xvcjogdmVjM2YgPSByZW5kZXIoY2FtZXJhUG9zaXRpb24sIGQpOwoKCXJldHVybiB2ZWM0Zihjb2xvciwgMS4wKTsKfQ==)
